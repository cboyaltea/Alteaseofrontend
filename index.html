<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Platform - Multi-User, Multi-Site, Multi-Language</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tab-active {
            border-bottom: 3px solid #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }

        .stats-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .content-preview {
            max-height: 300px;
            overflow-y: auto;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        /* PDF Export Styles */
        .pdf-content {
            background: white;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }

        .pdf-header {
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .pdf-section {
            margin-bottom: 30px;
        }

        .pdf-title {
            color: #1e40af;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .pdf-subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 20px;
        }

        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- üîê LOGIN/REGISTER PAGE -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="authPage" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="max-w-md w-full">
            <!-- Login Form -->
            <div id="loginForm" class="bg-white rounded-2xl shadow-2xl p-8 animate-fade-in">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">üöÄ SEO Platform</h1>
                    <p class="text-gray-600">Multi-User ‚Ä¢ Multi-Site ‚Ä¢ Multi-Language</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="loginEmail" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="votre@email.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                        <input type="password" id="loginPassword" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    
                    <button onclick="window.login()" 
                            class="w-full btn-primary text-white py-3 rounded-lg font-semibold">
                        Se connecter
                    </button>
                    
                    <div class="text-center">
                        <button onclick="window.showRegisterForm()" 
                                class="text-blue-600 hover:text-blue-800 font-medium">
                            Cr√©er un compte
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="bg-white rounded-2xl shadow-2xl p-8 animate-fade-in hidden">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">üìù Inscription</h1>
                    <p class="text-gray-600">Cr√©ez votre compte gratuitement</p>
                </div>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pr√©nom</label>
                            <input type="text" id="registerFirstName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="Jean">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nom</label>
                            <input type="text" id="registerLastName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="Dupont">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="registerEmail" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="votre@email.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mot de passe</label>
                        <input type="password" id="registerPassword" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nom de l'organisation</label>
                        <input type="text" id="registerOrganization" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                               placeholder="Ma Super Entreprise">
                    </div>
                    
                    <button onclick="window.register()" 
                            class="w-full btn-primary text-white py-3 rounded-lg font-semibold">
                        Cr√©er mon compte
                    </button>
                    
                    <div class="text-center">
                        <button onclick="window.showLoginForm()" 
                                class="text-blue-600 hover:text-blue-800 font-medium">
                            D√©j√† un compte ? Se connecter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- üìä MAIN DASHBOARD -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="dashboardPage" class="hidden min-h-screen bg-gray-50">
        <!-- Top Navigation Bar -->
        <nav class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-2xl font-bold gradient-bg bg-clip-text text-transparent">üöÄ SEO Platform</h1>
                        <span id="userInfo" class="ml-6 text-sm text-gray-600"></span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="window.refreshDashboard()" 
                                class="px-4 py-2 text-sm text-gray-700 hover:text-gray-900">
                            üîÑ Actualiser
                        </button>
                        <button onclick="window.logout()" 
                                class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 text-sm font-medium">
                            üö™ D√©connexion
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Tabs Navigation -->
        <div class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <nav class="flex space-x-8" id="tabsNav">
                    <button onclick="window.switchTab('dashboard')" 
                            class="py-4 px-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium text-gray-500 hover:text-gray-700 tab-button"
                            data-tab="dashboard">
                        üìä Dashboard
                    </button>
                    <button onclick="window.switchTab('websites')" 
                            class="py-4 px-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium text-gray-500 hover:text-gray-700 tab-button"
                            data-tab="websites">
                        üåê Sites Web
                    </button>
                    <button onclick="window.switchTab('content')" 
                            class="py-4 px-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium text-gray-500 hover:text-gray-700 tab-button"
                            data-tab="content">
                        ‚úçÔ∏è G√©n√©ration de Contenu
                    </button>
                    <button onclick="window.switchTab('analytics')" 
                            class="py-4 px-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium text-gray-500 hover:text-gray-700 tab-button"
                            data-tab="analytics">
                        üìà Analyses
                    </button>
                    <button onclick="window.switchTab('users')" 
                            class="py-4 px-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium text-gray-500 hover:text-gray-700 tab-button"
                            data-tab="users">
                        üë• Utilisateurs
                    </button>
                    <button onclick="window.switchTab('seopixel')" 
                            class="py-4 px-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium text-gray-500 hover:text-gray-700 tab-button"
                            data-tab="seopixel">
                        üéØ SEO Pixel
                    </button>
                    <button onclick="window.switchTab('installation')" 
                            class="py-4 px-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium text-gray-500 hover:text-gray-700 tab-button"
                            data-tab="installation">
                        ‚öôÔ∏è Installation
                    </button>
                    <button onclick="window.switchTab('seo-analysis')" 
                            class="py-4 px-1 border-b-2 border-transparent hover:border-gray-300 text-sm font-medium text-gray-500 hover:text-gray-700 tab-button"
                            data-tab="seo-analysis">
                        üîç SEO Analysis
                    </button>
                </nav>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 1: DASHBOARD -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-dashboard" class="tab-content">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Tableau de Bord</h2>
                    <p class="text-gray-600 mt-2">Vue d'ensemble de votre activit√© SEO</p>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stats-card bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Sites Web</p>
                                <p class="text-3xl font-bold text-gray-900" id="statsWebsites">0</p>
                            </div>
                            <div class="bg-blue-100 p-3 rounded-lg">
                                <span class="text-3xl">üåê</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Contenus G√©n√©r√©s</p>
                                <p class="text-3xl font-bold text-gray-900" id="statsContents">0</p>
                            </div>
                            <div class="bg-green-100 p-3 rounded-lg">
                                <span class="text-3xl">‚úçÔ∏è</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Pages Analys√©es</p>
                                <p class="text-3xl font-bold text-gray-900" id="statsAnalytics">0</p>
                            </div>
                            <div class="bg-purple-100 p-3 rounded-lg">
                                <span class="text-3xl">üìä</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats-card bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">Utilisateurs</p>
                                <p class="text-3xl font-bold text-gray-900" id="statsUsers">0</p>
                            </div>
                            <div class="bg-yellow-100 p-3 rounded-lg">
                                <span class="text-3xl">üë•</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Activit√© R√©cente</h3>
                    <div id="recentActivity" class="space-y-4">
                        <p class="text-gray-500 text-center py-8">Chargement...</p>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 2: WEBSITES -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-websites" class="tab-content hidden">
                <div class="mb-8 flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Sites Web</h2>
                        <p class="text-gray-600 mt-2">G√©rez tous vos sites en un seul endroit</p>
                    </div>
                    <button onclick="window.showAddWebsiteModal()" 
                            class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                        ‚ûï Ajouter un Site
                    </button>
                </div>

                <!-- Filter -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                    <div class="flex items-center space-x-4">
                        <label class="text-sm font-medium text-gray-700">Filtrer par langue:</label>
                        <select id="filterLanguage" onchange="loadWebsites()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Toutes les langues</option>
                            <option value="fr">üá´üá∑ Fran√ßais</option>
                            <option value="en">üá¨üáß English</option>
                            <option value="es">üá™üá∏ Espa√±ol</option>
                            <option value="de">üá©üá™ Deutsch</option>
                            <option value="it">üáÆüáπ Italiano</option>
                            <option value="pt">üáµüáπ Portugu√™s</option>
                        </select>
                    </div>
                </div>

                <!-- Websites Grid -->
                <div id="websitesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <p class="text-gray-500 text-center py-8 col-span-full">Chargement...</p>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 3: CONTENT GENERATION -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-content" class="tab-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">G√©n√©ration de Contenu IA</h2>
                    <p class="text-gray-600 mt-2">Cr√©ez du contenu SEO optimis√© avec Claude AI</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Generation Form -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-6">Nouveau Contenu</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Site Web</label>
                                    <select id="contentWebsite" 
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="">S√©lectionner un site...</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Type de Contenu</label>
                                    <select id="contentType" 
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="blog">üìù Article de Blog</option>
                                        <option value="product">üõçÔ∏è Description Produit</option>
                                        <option value="meta">üè∑Ô∏è Meta Description</option>
                                        <option value="landing">üéØ Page d'Atterrissage</option>
                                        <option value="social">üì± Post R√©seaux Sociaux</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Sujet / Th√®me</label>
                                    <input type="text" id="contentTopic" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                           placeholder="Ex: Les meilleures pratiques SEO en 2025">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Mots-cl√©s (s√©par√©s par des virgules)</label>
                                    <input type="text" id="contentKeywords" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                           placeholder="SEO, r√©f√©rencement, optimisation">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Langue</label>
                                    <select id="contentLanguage" 
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                        <option value="fr">üá´üá∑ Fran√ßais</option>
                                        <option value="en">üá¨üáß English</option>
                                        <option value="es">üá™üá∏ Espa√±ol</option>
                                        <option value="de">üá©üá™ Deutsch</option>
                                        <option value="it">üáÆüáπ Italiano</option>
                                        <option value="pt">üáµüáπ Portugu√™s</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Instructions suppl√©mentaires (optionnel)</label>
                                    <textarea id="contentInstructions" rows="3"
                                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                              placeholder="Ajoutez des instructions sp√©cifiques pour personnaliser le contenu..."></textarea>
                                </div>

                                <button onclick="window.generateContent()" 
                                        class="w-full btn-primary text-white py-4 rounded-lg font-semibold text-lg">
                                    ü§ñ G√©n√©rer le Contenu avec Claude AI
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Generated Content Preview -->
                    <div class="lg:col-span-1">
                        <div class="bg-white rounded-xl shadow-sm p-6 sticky top-6">
                            <h3 class="text-xl font-bold text-gray-900 mb-4">Aper√ßu</h3>
                            <div id="contentPreview" class="content-preview">
                                <p class="text-gray-500 text-center py-8">Le contenu g√©n√©r√© appara√Ætra ici</p>
                            </div>
                            
                            <div id="contentActions" class="hidden mt-6 space-y-3">
                                <button onclick="window.exportContentAsPDF()" 
                                        class="w-full bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-semibold">
                                    üìÑ Exporter en PDF
                                </button>
                                <button onclick="window.copyContent()" 
                                        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold">
                                    üìã Copier le Contenu
                                </button>
                                <button onclick="window.saveContent()" 
                                        class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold">
                                    üíæ Sauvegarder
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Contents -->
                <div class="mt-8 bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">Contenus R√©cents</h3>
                        <button onclick="window.loadContents()" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            üîÑ Actualiser
                        </button>
                    </div>
                    <div id="contentsList" class="space-y-4">
                        <p class="text-gray-500 text-center py-8">Chargement...</p>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 4: ANALYTICS -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-analytics" class="tab-content hidden">
                <div class="mb-8 flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Analyses SEO</h2>
                        <p class="text-gray-600 mt-2">Suivez les performances de vos sites</p>
                    </div>
                    <button onclick="window.exportAnalyticsReport()" 
                            class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold">
                        üìÑ Exporter Rapport PDF
                    </button>
                </div>

                <!-- Analytics by Website -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">S√©lectionner un site:</label>
                    <select id="analyticsWebsite" onchange="window.loadAnalytics()" 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="">Tous les sites</option>
                    </select>
                </div>

                <div id="analyticsData" class="grid grid-cols-1 gap-6">
                    <p class="text-gray-500 text-center py-8">Chargement des analyses...</p>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 5: USERS -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-users" class="tab-content hidden">
                <div class="mb-8 flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">Utilisateurs</h2>
                        <p class="text-gray-600 mt-2">G√©rez votre √©quipe</p>
                    </div>
                    <button onclick="window.showInviteUserModal()" 
                            class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                        ‚ûï Inviter un Utilisateur
                    </button>
                </div>

                <div id="usersList" class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <p class="text-gray-500 text-center py-8">Chargement...</p>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 6: SEO PIXEL -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-seopixel" class="tab-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">üéØ SEO Pixel - Modifications Dynamiques</h2>
                    <p class="text-gray-600 mt-2">G√©rez vos r√®gles SEO et installez le pixel sur vos sites</p>
                </div>

                <!-- Installation Card -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl shadow-lg p-8 mb-8 text-white">
                    <h3 class="text-2xl font-bold mb-4">üì¶ Installation du Pixel SEO</h3>
                    <p class="text-blue-100 mb-6">
                        Le pixel SEO modifie dynamiquement les balises de vos pages (title, meta, H1, Open Graph, etc.) 
                        bas√© sur les r√®gles que vous configurez. Simple et puissant !
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <h4 class="font-bold mb-2">1. S√©lectionnez votre site</h4>
                            <select id="pixelWebsiteSelect" onchange="window.generateSEOPixelCode()" 
                                    class="w-full px-4 py-2 rounded-lg text-gray-900 focus:ring-2 focus:ring-white">
                                <option value="">Choisir un site...</option>
                            </select>
                        </div>
                        
                        <div class="bg-white bg-opacity-20 rounded-lg p-4">
                            <h4 class="font-bold mb-2">2. Copiez et installez</h4>
                            <button onclick="window.copySEOPixelCode()" 
                                    class="w-full bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-opacity-90">
                                üìã Copier le Code d'Installation
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Pixel Code Display -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-8" id="pixelCodeSection" style="display:none;">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Code d'Installation</h3>
                    <p class="text-gray-600 mb-4">
                        Copiez ce code et collez-le dans le <code class="bg-gray-100 px-2 py-1 rounded">&lt;head&gt;</code> 
                        de toutes vos pages :
                    </p>
                    <div class="bg-gray-900 text-green-400 p-6 rounded-lg overflow-x-auto">
                        <pre id="seoPixelCodeDisplay" class="text-sm"></pre>
                    </div>
                    
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="border-l-4 border-blue-500 pl-4">
                            <h4 class="font-bold text-gray-900">Taille</h4>
                            <p class="text-sm text-gray-600">30 KB (8 KB gzipp√©)</p>
                        </div>
                        <div class="border-l-4 border-green-500 pl-4">
                            <h4 class="font-bold text-gray-900">Performance</h4>
                            <p class="text-sm text-gray-600">Impact &lt; 0.3s</p>
                        </div>
                        <div class="border-l-4 border-purple-500 pl-4">
                            <h4 class="font-bold text-gray-900">Compatibilit√©</h4>
                            <p class="text-sm text-gray-600">Tous navigateurs modernes</p>
                        </div>
                    </div>
                </div>

                <!-- SEO Rules Management -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">R√®gles SEO Actives</h3>
                            <p class="text-gray-600 text-sm mt-1">G√©rez les modifications dynamiques de vos pages</p>
                        </div>
                        <button onclick="window.showCreateRuleModal()" 
                                class="btn-primary text-white px-6 py-3 rounded-lg font-semibold">
                            ‚ûï Cr√©er une R√®gle
                        </button>
                    </div>

                    <!-- Filter -->
                    <div class="mb-6">
                        <select id="ruleWebsiteFilter" onchange="window.loadSEORules()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Tous les sites</option>
                        </select>
                    </div>

                    <!-- Rules List -->
                    <div id="seoRulesList">
                        <p class="text-gray-500 text-center py-8">Aucune r√®gle SEO pour le moment</p>
                    </div>
                </div>

                <!-- Quick Examples -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                    <div class="bg-blue-50 rounded-lg p-6 border border-blue-200">
                        <div class="text-3xl mb-3">üè†</div>
                        <h4 class="font-bold text-gray-900 mb-2">Homepage</h4>
                        <p class="text-sm text-gray-600 mb-4">
                            Modifier le title et meta description de votre page d'accueil
                        </p>
                        <button onclick="window.createExampleRule('homepage')" 
                                class="text-blue-600 font-semibold text-sm hover:text-blue-800">
                            Cr√©er cette r√®gle ‚Üí
                        </button>
                    </div>

                    <div class="bg-green-50 rounded-lg p-6 border border-green-200">
                        <div class="text-3xl mb-3">üõçÔ∏è</div>
                        <h4 class="font-bold text-gray-900 mb-2">Pages Produits</h4>
                        <p class="text-sm text-gray-600 mb-4">
                            Optimiser toutes vos pages produits avec structured data
                        </p>
                        <button onclick="window.createExampleRule('products')" 
                                class="text-green-600 font-semibold text-sm hover:text-green-800">
                            Cr√©er cette r√®gle ‚Üí
                        </button>
                    </div>

                    <div class="bg-purple-50 rounded-lg p-6 border border-purple-200">
                        <div class="text-3xl mb-3">üìù</div>
                        <h4 class="font-bold text-gray-900 mb-2">Articles Blog</h4>
                        <p class="text-sm text-gray-600 mb-4">
                            Ajouter Schema.org Article √† tous vos posts
                        </p>
                        <button onclick="window.createExampleRule('blog')" 
                                class="text-purple-600 font-semibold text-sm hover:text-purple-800">
                            Cr√©er cette r√®gle ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 7: INSTALLATION -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-installation" class="tab-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-900">Installation du Pixel</h2>
                    <p class="text-gray-600 mt-2">Installez le pixel de tracking sur vos sites</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">1. S√©lectionnez un site</h3>
                        <select id="installationWebsite" onchange="window.generatePixelCode()" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Choisir un site...</option>
                        </select>

                        <h3 class="text-xl font-bold text-gray-900 mt-8 mb-4">2. Copiez le code</h3>
                        <div class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-x-auto">
                            <pre id="pixelCode" class="text-sm"><code>// S√©lectionnez d'abord un site</code></pre>
                        </div>
                        <button onclick="window.copyPixelCode()" 
                                class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold">
                            üìã Copier le Code
                        </button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">3. Instructions d'installation</h3>
                        
                        <div class="space-y-4">
                            <div class="border-l-4 border-blue-500 pl-4 py-2">
                                <h4 class="font-bold text-gray-900 mb-2">WordPress</h4>
                                <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                                    <li>Allez dans Apparence > √âditeur de th√®me</li>
                                    <li>Ouvrez le fichier header.php</li>
                                    <li>Collez le code avant &lt;/head&gt;</li>
                                    <li>Sauvegardez</li>
                                </ol>
                            </div>

                            <div class="border-l-4 border-green-500 pl-4 py-2">
                                <h4 class="font-bold text-gray-900 mb-2">Shopify</h4>
                                <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                                    <li>Allez dans Boutique en ligne > Th√®mes</li>
                                    <li>Actions > Modifier le code</li>
                                    <li>Ouvrez theme.liquid</li>
                                    <li>Collez le code avant &lt;/head&gt;</li>
                                    <li>Sauvegardez</li>
                                </ol>
                            </div>

                            <div class="border-l-4 border-purple-500 pl-4 py-2">
                                <h4 class="font-bold text-gray-900 mb-2">Site HTML</h4>
                                <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                                    <li>Ouvrez votre fichier index.html</li>
                                    <li>Collez le code avant &lt;/head&gt;</li>
                                    <li>Sauvegardez et uploadez</li>
                                </ol>
                            </div>

                            <div class="border-l-4 border-yellow-500 pl-4 py-2">
                                <h4 class="font-bold text-gray-900 mb-2">Google Tag Manager</h4>
                                <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                                    <li>Cr√©ez une nouvelle balise</li>
                                    <li>Type: HTML personnalis√©</li>
                                    <li>Collez le code</li>
                                    <li>D√©clencheur: All Pages</li>
                                    <li>Publiez</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- üîç SEO ANALYSIS TAB -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-seo-analysis" class="tab-content hidden">
                <div class="mb-8 flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">üîç SEO Analysis</h2>
                        <p class="text-gray-600 mt-2">Analysez et optimisez votre r√©f√©rencement avec l'IA</p>
                    </div>
                    <div class="flex gap-3">
                        <select id="seoWebsiteFilter" onchange="window.loadSEOAnalyses()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Tous les sites</option>
                        </select>
                        <button onclick="window.runSEOAnalysis()" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors">
                            üîç Analyser une page
                        </button>
                    </div>
                </div>

                <!-- Zone de contenu SEO -->
                <div id="seoContent">
                    <div class="text-center py-12">
                        <div class="spinner mx-auto"></div>
                        <p class="text-gray-600 mt-4">Chargement des analyses...</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- üé≠ SEO ANALYSIS MODALS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- Modal: Nouvelle Analyse SEO -->
    <div id="seoAnalysisModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="modal-overlay fixed inset-0" onclick="window.closeSEOAnalysisModal()"></div>
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8 relative z-10 animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">üîç Nouvelle Analyse SEO</h3>
                    <button onclick="window.closeSEOAnalysisModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Site Web</label>
                        <select id="seoAnalysisWebsite" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">S√©lectionner un site</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">URL de la page</label>
                        <input type="url" id="seoAnalysisUrl" placeholder="https://monsite.com/page" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <p class="text-sm text-blue-800">
                            <strong>üìå Comment √ßa marche :</strong><br>
                            1. Le pixel SEO sur votre site collectera automatiquement les donn√©es<br>
                            2. L'analyse calculera un score SEO sur 100<br>
                            3. L'IA g√©n√®rera des recommandations personnalis√©es
                        </p>
                    </div>

                    <div class="flex gap-3 justify-end mt-6">
                        <button onclick="window.closeSEOAnalysisModal()" 
                                class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Annuler
                        </button>
                        <button onclick="window.submitSEOAnalysis()" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Lancer l'analyse
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: D√©tails d'une Analyse -->
    <div id="seoDetailsModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="modal-overlay fixed inset-0" onclick="window.closeSEODetailsModal()"></div>
            <div class="bg-white rounded-xl shadow-2xl max-w-6xl w-full p-8 max-h-screen overflow-y-auto relative z-10 animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">üìä D√©tails de l'Analyse SEO</h3>
                    <button onclick="window.closeSEODetailsModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div id="seoDetailsContent">
                    <!-- Contenu charg√© dynamiquement -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Appliquer une Recommandation -->
    <div id="applyRecommendationModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="modal-overlay fixed inset-0" onclick="window.closeApplyRecommendationModal()"></div>
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full p-8 relative z-10 animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">‚ú® Appliquer la Recommandation</h3>
                    <button onclick="window.closeApplyRecommendationModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <div id="recommendationPreview" class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <!-- Recommendation details -->
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                        <input type="text" id="applyTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Meta Description</label>
                        <textarea id="applyDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">H1</label>
                        <input type="text" id="applyH1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div class="flex gap-3 justify-end mt-6">
                        <button onclick="window.closeApplyRecommendationModal()" 
                                class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Annuler
                        </button>
                        <button onclick="window.submitApplyRecommendation()" 
                                class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            Cr√©er la r√®gle SEO
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- üé≠ MODALS -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

    <!-- Add Website Modal -->
    <div id="addWebsiteModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="modal-overlay fixed inset-0" onclick="window.closeAddWebsiteModal()"></div>
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-8 relative z-10 animate-fade-in">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Ajouter un Site Web</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nom du site</label>
                        <input type="text" id="newWebsiteName" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Mon Super Site">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">URL</label>
                        <input type="url" id="newWebsiteUrl" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="https://monsite.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Langue</label>
                        <select id="newWebsiteLanguage" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="fr">üá´üá∑ Fran√ßais</option>
                            <option value="en">üá¨üáß English</option>
                            <option value="es">üá™üá∏ Espa√±ol</option>
                            <option value="de">üá©üá™ Deutsch</option>
                            <option value="it">üáÆüáπ Italiano</option>
                            <option value="pt">üáµüáπ Portugu√™s</option>
                        </select>
                    </div>
                    
                    <div class="flex space-x-3 mt-6">
                        <button onclick="window.closeAddWebsiteModal()" 
                                class="flex-1 px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium">
                            Annuler
                        </button>
                        <button onclick="window.addWebsite()" 
                                class="flex-1 btn-primary text-white py-3 rounded-lg font-semibold">
                            Ajouter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rule Editor Modal -->
    <div id="ruleEditorModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <div class="modal-overlay fixed inset-0" onclick="window.closeRuleModal()"></div>
            
            <div class="bg-white rounded-xl shadow-2xl max-w-5xl w-full relative z-10 animate-fade-in">
                <!-- Header -->
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-6 rounded-t-xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 id="modalTitle" class="text-3xl font-bold">Cr√©er une R√®gle SEO</h3>
                            <p class="text-blue-100 mt-2">Configurez vos modifications SEO dynamiques</p>
                        </div>
                        <button onclick="window.closeRuleModal()" 
                                class="text-white hover:text-gray-200 text-4xl leading-none">
                            √ó
                        </button>
                    </div>
                </div>

                <!-- Body -->
                <div class="px-8 py-6 max-h-[70vh] overflow-y-auto">
                    <!-- Basic Info Section -->
                    <div class="mb-8">
                        <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">1</span>
                            Informations de base
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Nom de la r√®gle <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="ruleName" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                       placeholder="Ex: Homepage - SEO Optimized">
                            </div>
                            
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description (optionnelle)</label>
                                <textarea id="ruleDescription" rows="2"
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                          placeholder="Ex: Optimise le title et meta description de la homepage"></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Site web <span class="text-red-500">*</span>
                                </label>
                                <select id="ruleWebsite" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Choisir un site...</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Statut</label>
                                <select id="ruleStatus" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="draft">üü° Brouillon</option>
                                    <option value="active">üü¢ Actif</option>
                                    <option value="inactive">‚ö´ Inactif</option>
                                    <option value="testing">üîµ Test</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Targeting Section -->
                    <div class="mb-8 border-t pt-8">
                        <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="bg-purple-100 text-purple-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">2</span>
                            Ciblage des pages
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Type de correspondance</label>
                                <select id="ruleMatchType" 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="exact">Exacte</option>
                                    <option value="starts_with">Commence par</option>
                                    <option value="contains">Contient</option>
                                    <option value="ends_with">Se termine par</option>
                                    <option value="regex">Regex (avanc√©)</option>
                                </select>
                            </div>
                            
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Pattern d'URL <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="ruleUrlPattern" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                       placeholder="Ex: / ou /products/ ou /blog/*">
                                <p class="text-xs text-gray-500 mt-1">
                                    Exemples: <code>/</code> (homepage), <code>/products/</code> (toutes les pages produits)
                                </p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Priorit√©</label>
                                <input type="number" id="rulePriority" value="100" min="0" max="1000"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Plus √©lev√© = plus prioritaire (0-1000)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Modifications Section -->
                    <div class="mb-8 border-t pt-8">
                        <h4 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                            <span class="bg-green-100 text-green-600 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm">3</span>
                            Modifications SEO
                        </h4>
                        
                        <p class="text-sm text-gray-600 mb-4">S√©lectionnez les √©l√©ments que vous souhaitez modifier</p>
                        
                        <!-- Title -->
                        <div class="mb-4">
                            <label class="flex items-center cursor-pointer mb-2">
                                <input type="checkbox" id="modTitle" onchange="window.updateModificationSections()"
                                       class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 mr-3">
                                <span class="font-semibold text-gray-900">üìÑ Title Tag</span>
                            </label>
                            <div id="titleSection" style="display:none;" class="ml-8 p-4 bg-gray-50 rounded-lg">
                                <div class="grid grid-cols-3 gap-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Action</label>
                                        <select id="titleAction" class="w-full px-3 py-2 text-sm border rounded">
                                            <option value="replace">Remplacer</option>
                                            <option value="prepend">Ajouter avant</option>
                                            <option value="append">Ajouter apr√®s</option>
                                            <option value="template">Template</option>
                                        </select>
                                    </div>
                                    <div class="col-span-2">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Valeur</label>
                                        <input type="text" id="titleValue" 
                                               class="w-full px-3 py-2 text-sm border rounded"
                                               placeholder="Ex: {original} | Ma Marque - 2024">
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Variables: {original}, {brand}, {year}</p>
                            </div>
                        </div>

                        <!-- Meta Description -->
                        <div class="mb-4">
                            <label class="flex items-center cursor-pointer mb-2">
                                <input type="checkbox" id="modMeta" onchange="window.updateModificationSections()"
                                       class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 mr-3">
                                <span class="font-semibold text-gray-900">üìù Meta Description</span>
                            </label>
                            <div id="metaSection" style="display:none;" class="ml-8 p-4 bg-gray-50 rounded-lg">
                                <div class="grid grid-cols-3 gap-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Action</label>
                                        <select id="metaAction" class="w-full px-3 py-2 text-sm border rounded">
                                            <option value="replace">Remplacer</option>
                                            <option value="append">Ajouter apr√®s</option>
                                            <option value="template">Template</option>
                                        </select>
                                    </div>
                                    <div class="col-span-2">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Valeur</label>
                                        <textarea id="metaValue" rows="2"
                                                  class="w-full px-3 py-2 text-sm border rounded"
                                                  placeholder="Description optimis√©e pour SEO (max 160 caract√®res)"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- H1 -->
                        <div class="mb-4">
                            <label class="flex items-center cursor-pointer mb-2">
                                <input type="checkbox" id="modH1" onchange="window.updateModificationSections()"
                                       class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500 mr-3">
                                <span class="font-semibold text-gray-900">üìå H1 Tag</span>
                            </label>
                            <div id="h1Section" style="display:none;" class="ml-8 p-4 bg-gray-50 rounded-lg">
                                <div class="grid grid-cols-3 gap-3">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Action</label>
                                        <select id="h1Action" class="w-full px-3 py-2 text-sm border rounded">
                                            <option value="replace">Remplacer</option>
                                            <option value="inject_if_missing">Ajouter si manquant</option>
                                        </select>
                                    </div>
                                    <div class="col-span-2">
                                        <label class="block text-xs font-medium text-gray-700 mb-1">Valeur</label>
                                        <input type="text" id="h1Value" 
                                               class="w-full px-3 py-2 text-sm border rounded"
                                               placeholder="Nouveau H1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Other modifications (simplified) -->
                        <div class="grid grid-cols-2 gap-3 ml-8 mt-4">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="modOG" class="w-4 h-4 text-blue-600 rounded mr-2">
                                <span class="text-sm text-gray-700">üåê Open Graph (Facebook)</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="modTwitter" class="w-4 h-4 text-blue-600 rounded mr-2">
                                <span class="text-sm text-gray-700">üê¶ Twitter Card</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="modCanonical" class="w-4 h-4 text-blue-600 rounded mr-2">
                                <span class="text-sm text-gray-700">üîó Canonical URL</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="modRobots" class="w-4 h-4 text-blue-600 rounded mr-2">
                                <span class="text-sm text-gray-700">ü§ñ Robots Meta</span>
                            </label>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="modSchema" class="w-4 h-4 text-blue-600 rounded mr-2">
                                <span class="text-sm text-gray-700">üìä Schema.org JSON-LD</span>
                            </label>
                        </div>

                        <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-800">
                                üí° <strong>Astuce:</strong> Cochez au moins une modification pour cr√©er une r√®gle fonctionnelle.
                                Les modifications avanc√©es peuvent √™tre configur√©es apr√®s cr√©ation.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="px-8 py-6 bg-gray-50 border-t rounded-b-xl">
                    <div class="flex justify-between items-center">
                        <p class="text-sm text-gray-600">
                            <span class="text-red-500">*</span> Champs obligatoires
                        </p>
                        <div class="flex space-x-3">
                            <button onclick="window.closeRuleModal()" 
                                    class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-100 font-medium">
                                Annuler
                            </button>
                            <button onclick="window.saveRule()" 
                                    class="px-8 py-3 btn-primary text-white rounded-lg font-semibold">
                                üíæ Enregistrer la R√®gle
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pixel Code Modal -->
    <div id="pixelCodeModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="modal-overlay fixed inset-0 bg-black opacity-50" onclick="window.closePixelCodeModal()"></div>
            
            <div class="relative bg-white rounded-xl shadow-2xl max-w-4xl w-full animate-fade-in p-6 z-10">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-2xl font-bold text-gray-900">
                        üéØ Code de tracking install√©
                    </h3>
                    <button onclick="window.closePixelCodeModal()" 
                            class="text-gray-400 hover:text-gray-600 text-2xl">
                        √ó
                    </button>
                </div>

                <!-- Success Message -->
                <div class="bg-green-50 border-l-4 border-green-400 p-4 mb-6">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-green-700">
                                <strong>Site cr√©√© avec succ√®s !</strong> Copiez et installez ce code sur votre site pour commencer le tracking.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Site Info -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <h4 class="font-semibold text-gray-700 mb-2">üìä Informations du site</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">Nom:</span>
                            <span class="ml-2 font-medium" id="modalSiteName">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">URL:</span>
                            <span class="ml-2 font-medium" id="modalSiteUrl">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Langue:</span>
                            <span class="ml-2 font-medium" id="modalSiteLanguage">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">ID:</span>
                            <code class="ml-2 bg-white px-2 py-1 rounded text-xs" id="modalSiteId">-</code>
                        </div>
                    </div>
                </div>

                <!-- Pixel Code -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-gray-700">üîß Code √† installer</h4>
                        <button onclick="window.copyModalPixelCode()" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                            üìã Copier le code
                        </button>
                    </div>
                    
                    <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto max-h-96">
                        <pre id="modalPixelCode" class="text-green-400 text-xs font-mono whitespace-pre-wrap"></pre>
                    </div>
                </div>

                <!-- Installation Instructions -->
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                    <h4 class="font-semibold text-yellow-800 mb-2">üìù Instructions d'installation</h4>
                    <ol class="list-decimal list-inside space-y-2 text-sm text-yellow-700">
                        <li><strong>WordPress:</strong> Apparence ‚Üí √âditeur de th√®me ‚Üí header.php (avant &lt;/head&gt;)</li>
                        <li><strong>Shopify:</strong> Boutique en ligne ‚Üí Th√®mes ‚Üí Modifier le code ‚Üí theme.liquid (avant &lt;/head&gt;)</li>
                        <li><strong>HTML:</strong> Collez dans le &lt;head&gt; de votre fichier HTML (avant &lt;/head&gt;)</li>
                        <li><strong>Google Tag Manager:</strong> Cr√©ez une balise HTML personnalis√©e</li>
                    </ol>
                </div>

                <!-- Actions -->
                <div class="flex justify-between items-center">
                    <button onclick="window.goToInstallationTab()" 
                            class="text-blue-600 hover:text-blue-700 font-medium">
                        ‚Üí Voir tous les codes d'installation
                    </button>
                    <button onclick="window.closePixelCodeModal()" 
                            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-6 py-2 rounded-lg font-medium transition">
                        Fermer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Invite User Modal -->
    <div id="inviteUserModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="modal-overlay fixed inset-0" onclick="window.closeInviteUserModal()"></div>
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-8 relative z-10 animate-fade-in">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Inviter un Utilisateur</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="inviteUserEmail" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="utilisateur@email.com">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pr√©nom</label>
                            <input type="text" id="inviteUserFirstName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Jean">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nom</label>
                            <input type="text" id="inviteUserLastName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Dupont">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">R√¥le</label>
                        <select id="inviteUserRole" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="user">üë§ Utilisateur</option>
                            <option value="admin">üëë Administrateur</option>
                            <option value="viewer">üëÅÔ∏è Observateur</option>
                        </select>
                    </div>
                    
                    <div class="flex space-x-3 mt-6">
                        <button onclick="window.closeInviteUserModal()" 
                                class="flex-1 px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 font-medium">
                            Annuler
                        </button>
                        <button onclick="window.inviteUser()" 
                                class="flex-1 btn-primary text-white py-3 rounded-lg font-semibold">
                            Inviter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="bg-white rounded-xl p-8 shadow-2xl text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-700 font-medium" id="loadingText">Chargement...</p>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- üé¨ JAVASCRIPT -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        console.log("üöÄ ==== SCRIPT CHARG√â ====");
        console.log("‚úÖ window.login sera d√©fini dans quelques lignes...");
        // üîß CONFIGURATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const API_URL = 'https://alteaseo-production.up.railway.app';
        
        let currentUser = null;
        let currentToken = null;
        let currentTab = 'dashboard';
        let generatedContent = null;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üîê AUTHENTICATION FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.login = async function() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                window.showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }

            window.showLoading('Connexion en cours...');

            try {
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = data.user;
                    currentToken = data.token;
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    window.showNotification('Connexion r√©ussie !', 'success');
                    showDashboard();
                } else {
                    window.showNotification(data.error || 'Erreur de connexion', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }
        console.log("‚úÖ window.login d√©finie:", typeof window.login);

        window.register = async function() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const firstName = document.getElementById('registerFirstName').value;
            const lastName = document.getElementById('registerLastName').value;
            const organizationName = document.getElementById('registerOrganization').value;

            if (!email || !password || !firstName || !lastName || !organizationName) {
                window.showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }

            window.showLoading('Cr√©ation du compte...');

            try {
                const response = await fetch(`${API_URL}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, firstName, lastName, organizationName })
                });

                const data = await response.json();

                if (data.success) {
                    currentUser = data.user;
                    currentToken = data.token;
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    window.showNotification('Compte cr√©√© avec succ√®s !', 'success');
                    showDashboard();
                } else {
                    window.showNotification(data.error || 'Erreur lors de l\'inscription', 'error');
                }
            } catch (error) {
                console.error('Register error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }

        window.logout = function() {
            currentUser = null;
            currentToken = null;
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('authPage').classList.remove('hidden');
            
            window.showNotification('D√©connexion r√©ussie', 'success');
        }

        window.showLoginForm = function() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        window.showRegisterForm = function() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä DASHBOARD FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.showDashboard = async function() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            
            // Update user info
            document.getElementById('userInfo').textContent = 
                `${currentUser.firstName} ${currentUser.lastName} ‚Ä¢ ${currentUser.organization?.name || 'Organisation'}`;
            
            // Load dashboard data
            await refreshDashboard();
            
            // Set first tab as active
            switchTab('dashboard');
        }

        window.refreshDashboard = async function() {
            window.showLoading('Actualisation...');
            
            try {
                await Promise.all([
                    loadStats(),
                    loadWebsites(),
                    loadContents(),
                    loadUsers(),
                    loadRecentActivity()
                ]);
                
                window.showNotification('Dashboard actualis√©', 'success');
            } catch (error) {
                console.error('Refresh error:', error);
                window.showNotification('Erreur lors de l\'actualisation', 'error');
            } finally {
                window.hideLoading();
            }
        }

        window.loadStats = async function() {
            try {
                const headers = { 'Authorization': `Bearer ${currentToken}` };
                
                // Charger d'abord les sites pour obtenir le websiteId
                const websitesResponse = await fetch(`${API_URL}/api/websites`, { headers });
                const websites = await websitesResponse.json();
                
                const websitesList = websites.websites || [];
                const firstWebsite = websitesList[0];
                
                // Charger analytics avec websiteId si disponible
                let analyticsData = { data: [] };
                if (firstWebsite) {
                    const startDate = new Date(Date.now() - 30 * 24 * 3600000).toISOString().split('T')[0];
                    const endDate = new Date().toISOString().split('T')[0];
                    const analyticsUrl = `${API_URL}/api/analytics?websiteId=${firstWebsite._id}&startDate=${startDate}&endDate=${endDate}`;
                    
                    const analyticsResponse = await fetch(analyticsUrl, { headers });
                    if (analyticsResponse.ok) {
                        const analyticsArray = await analyticsResponse.json();
                        analyticsData = { data: analyticsArray };
                    }
                }
                
                // Charger le reste
                const [contents, users] = await Promise.all([
                    fetch(`${API_URL}/api/content`, { headers }).then(r => r.json()),
                    fetch(`${API_URL}/api/users`, { headers }).then(r => r.json())
                ]);
                
                document.getElementById('statsWebsites').textContent = websitesList.length || 0;
                document.getElementById('statsContents').textContent = contents.contents?.length || 0;
                document.getElementById('statsAnalytics').textContent = analyticsData.data?.length || 0;
                document.getElementById('statsUsers').textContent = users.users?.length || 0;
            } catch (error) {
                console.error('Load stats error:', error);
            }
        }

        window.loadRecentActivity = async function() {
            try {
                const response = await fetch(`${API_URL}/api/analytics/recent`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const data = await response.json();
                
                const activityHTML = data.activities?.map(activity => `
                    <div class="flex items-center space-x-4 p-4 hover:bg-gray-50 rounded-lg">
                        <div class="text-2xl">${getActivityIcon(activity.type)}</div>
                        <div class="flex-1">
                            <p class="font-medium text-gray-900">${activity.description}</p>
                            <p class="text-sm text-gray-500">${formatDate(activity.createdAt)}</p>
                        </div>
                    </div>
                `).join('') || '<p class="text-gray-500 text-center py-8">Aucune activit√© r√©cente</p>';
                
                document.getElementById('recentActivity').innerHTML = activityHTML;
            } catch (error) {
                console.error('Load activity error:', error);
                document.getElementById('recentActivity').innerHTML = 
                    '<p class="text-gray-500 text-center py-8">Erreur de chargement</p>';
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üåê WEBSITES FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.loadWebsites = async function() {
            const language = document.getElementById('filterLanguage')?.value || '';
            
            try {
                let url = `${API_URL}/api/websites`;
                if (language) url += `?language=${language}`;
                
                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const data = await response.json();
                
                if (data.success && data.websites) {
                    // Stocker les sites pour pouvoir les r√©utiliser
                    window.currentWebsites = data.websites;
                    
                    const websitesHTML = data.websites.map(website => `
                        <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow border-2 border-gray-100 hover:border-blue-200">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-900 mb-1">${website.name}</h3>
                                    <a href="${website.url}" target="_blank" class="text-sm text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1">
                                        ${website.url}
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                    </a>
                                </div>
                                <div class="flex flex-col items-end gap-2">
                                    <span class="text-3xl">${getLanguageFlag(website.language)}</span>
                                    <span class="text-xs font-medium px-2 py-1 rounded-full bg-blue-50 text-blue-700">
                                        ${website.language.toUpperCase()}
                                    </span>
                                </div>
                            </div>
                            
                            <!-- ID du site -->
                            <div class="mb-4 p-2 bg-gray-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-500 font-medium">ID du site:</span>
                                    <code class="text-xs font-mono bg-white px-2 py-1 rounded border border-gray-200">${website._id}</code>
                                </div>
                            </div>
                            
                            <!-- Boutons d'action -->
                            <div class="flex gap-2 mt-4">
                                <button onclick="window.showPixelCodeForWebsite('${website._id}')" 
                                        class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-2.5 rounded-lg text-sm font-semibold transition-all shadow-sm hover:shadow flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                                    </svg>
                                    <span>Voir le code</span>
                                </button>
                                <button onclick="window.deleteWebsite('${website._id}')" 
                                        class="bg-red-50 hover:bg-red-100 text-red-600 hover:text-red-700 px-4 py-2.5 rounded-lg text-sm font-semibold transition-all border border-red-200 hover:border-red-300"
                                        title="Supprimer le site">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- Footer avec date -->
                            <div class="mt-4 pt-4 border-t border-gray-100 flex items-center justify-between">
                                <div class="flex items-center gap-2 text-xs text-gray-500">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    <span>${formatDate(website.createdAt)}</span>
                                </div>
                                <div class="flex items-center gap-1 text-xs font-medium text-green-600 bg-green-50 px-2 py-1 rounded-full">
                                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                    <span>Actif</span>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('websitesList').innerHTML = websitesHTML || 
                        '<p class="text-gray-500 text-center py-8 col-span-full">Aucun site trouv√©</p>';
                    
                    // Update dropdowns
                    updateWebsiteDropdowns(data.websites);
                }
            } catch (error) {
                console.error('Load websites error:', error);
                document.getElementById('websitesList').innerHTML = 
                    '<p class="text-gray-500 text-center py-8 col-span-full">Erreur de chargement</p>';
            }
        }

        function updateWebsiteDropdowns(websites) {
            const dropdowns = ['contentWebsite', 'analyticsWebsite', 'installationWebsite'];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    const currentValue = dropdown.value;
                    dropdown.innerHTML = '<option value="">S√©lectionner un site...</option>' +
                        websites.map(w => `<option value="${w._id}">${w.name} (${w.url})</option>`).join('');
                    dropdown.value = currentValue;
                }
            });
        }

        window.addWebsite = async function() {
            const name = document.getElementById('newWebsiteName').value;
            const url = document.getElementById('newWebsiteUrl').value;
            const language = document.getElementById('newWebsiteLanguage').value;

            if (!name || !url || !language) {
                window.showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }

            window.showLoading('Ajout du site...');

            try {
                const response = await fetch(`${API_URL}/api/websites`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ name, url, language })
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification('Site ajout√© avec succ√®s !', 'success');
                    closeAddWebsiteModal();
                    
                    // ‚ú® Afficher le code pixel automatiquement
                    setTimeout(() => {
                        window.showPixelCodeModal(data.website);
                    }, 500);
                    
                    await loadWebsites();
                } else {
                    window.showNotification(data.error || 'Erreur lors de l\'ajout', 'error');
                }
            } catch (error) {
                console.error('Add website error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }

        async function deleteWebsite(websiteId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer ce site ?')) return;

            window.showLoading('Suppression...');

            try {
                const response = await fetch(`${API_URL}/api/websites/${websiteId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification('Site supprim√©', 'success');
                    await loadWebsites();
                } else {
                    window.showNotification(data.error || 'Erreur lors de la suppression', 'error');
                }
            } catch (error) {
                console.error('Delete website error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ‚úçÔ∏è CONTENT GENERATION FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.generateContent = async function() {
            const websiteId = document.getElementById('contentWebsite').value;
            const contentType = document.getElementById('contentType').value;
            const topic = document.getElementById('contentTopic').value;
            const keywords = document.getElementById('contentKeywords').value;
            const language = document.getElementById('contentLanguage').value;
            const instructions = document.getElementById('contentInstructions').value;

            if (!websiteId || !topic || !keywords) {
                window.showNotification('Veuillez remplir les champs obligatoires', 'error');
                return;
            }

            window.showLoading('G√©n√©ration du contenu avec Claude AI...');

            try {
                const response = await fetch(`${API_URL}/api/content/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({
                        websiteId,
                        contentType,
                        topic,
                        keywords: keywords.split(',').map(k => k.trim()),
                        language,
                        instructions
                    })
                });

                const data = await response.json();

                if (data.success) {
                    generatedContent = data.content;
                    displayGeneratedContent(data.content);
                    window.showNotification('Contenu g√©n√©r√© avec succ√®s !', 'success');
                } else {
                    window.showNotification(data.error || 'Erreur lors de la g√©n√©ration', 'error');
                }
            } catch (error) {
                console.error('Generate content error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }

        function displayGeneratedContent(content) {
            const previewHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="font-bold text-gray-900 mb-2">${content.title || 'Titre'}</h4>
                        <div class="text-sm text-gray-700 whitespace-pre-wrap">${content.content || ''}</div>
                    </div>
                    ${content.metadata?.metaDescription ? `
                        <div class="border-t pt-4">
                            <h5 class="text-sm font-bold text-gray-700 mb-1">Meta Description:</h5>
                            <p class="text-sm text-gray-600">${content.metadata.metaDescription}</p>
                        </div>
                    ` : ''}
                    ${content.metadata?.keywords?.length ? `
                        <div class="border-t pt-4">
                            <h5 class="text-sm font-bold text-gray-700 mb-2">Mots-cl√©s:</h5>
                            <div class="flex flex-wrap gap-2">
                                ${content.metadata.keywords.map(k => 
                                    `<span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">${k}</span>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('contentPreview').innerHTML = previewHTML;
            document.getElementById('contentActions').classList.remove('hidden');
        }

        window.saveContent = async function() {
            if (!generatedContent) {
                window.showNotification('Aucun contenu √† sauvegarder', 'error');
                return;
            }

            window.showLoading('Sauvegarde...');

            try {
                const response = await fetch(`${API_URL}/api/content`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify(generatedContent)
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification('Contenu sauvegard√© !', 'success');
                    await loadContents();
                } else {
                    window.showNotification(data.error || 'Erreur lors de la sauvegarde', 'error');
                }
            } catch (error) {
                console.error('Save content error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }

        window.copyContent = function() {
            if (!generatedContent) {
                window.showNotification('Aucun contenu √† copier', 'error');
                return;
            }

            const textToCopy = `${generatedContent.title}\n\n${generatedContent.content}`;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                window.showNotification('Contenu copi√© dans le presse-papier !', 'success');
            }).catch(() => {
                window.showNotification('Erreur lors de la copie', 'error');
            });
        }

        window.loadContents = async function() {
            try {
                const response = await fetch(`${API_URL}/api/content`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const data = await response.json();
                
                if (data.success && data.contents) {
                    const contentsHTML = data.contents.slice(0, 10).map(content => `
                        <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-gray-900">${content.title}</h4>
                                <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">${content.contentType}</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2 line-clamp-2">${content.content.substring(0, 100)}...</p>
                            <div class="flex justify-between items-center text-xs text-gray-500">
                                <span>${getLanguageFlag(content.language)} ${formatDate(content.createdAt)}</span>
                                <div class="space-x-2">
                                    <button onclick="window.exportContentItemAsPDF('${content._id}')" 
                                            class="text-red-600 hover:text-red-800 font-medium">
                                        üìÑ PDF
                                    </button>
                                    <button onclick="window.deleteContent('${content._id}')" 
                                            class="text-red-600 hover:text-red-800 font-medium">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('contentsList').innerHTML = contentsHTML || 
                        '<p class="text-gray-500 text-center py-8">Aucun contenu trouv√©</p>';
                }
            } catch (error) {
                console.error('Load contents error:', error);
            }
        }

        async function deleteContent(contentId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer ce contenu ?')) return;

            window.showLoading('Suppression...');

            try {
                const response = await fetch(`${API_URL}/api/content/${contentId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification('Contenu supprim√©', 'success');
                    await loadContents();
                } else {
                    window.showNotification(data.error || 'Erreur lors de la suppression', 'error');
                }
            } catch (error) {
                console.error('Delete content error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìÑ PDF EXPORT FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.exportContentAsPDF = async function() {
            if (!generatedContent) {
                window.showNotification('Aucun contenu √† exporter', 'error');
                return;
            }

            window.showLoading('G√©n√©ration du PDF...');

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add header
                doc.setFontSize(20);
                doc.setTextColor(59, 130, 246);
                doc.text('SEO Platform - Contenu G√©n√©r√©', 20, 20);
                
                // Add date
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text(`G√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}`, 20, 30);
                
                // Add line
                doc.setDrawColor(59, 130, 246);
                doc.setLineWidth(0.5);
                doc.line(20, 35, 190, 35);
                
                // Add title
                doc.setFontSize(16);
                doc.setTextColor(0, 0, 0);
                doc.text(generatedContent.title || 'Sans titre', 20, 45);
                
                // Add content
                doc.setFontSize(11);
                doc.setTextColor(55, 65, 81);
                const contentLines = doc.splitTextToSize(generatedContent.content || '', 170);
                doc.text(contentLines, 20, 55);
                
                // Add metadata if exists
                let yPosition = 55 + (contentLines.length * 5);
                
                if (generatedContent.metadata?.metaDescription) {
                    yPosition += 10;
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.setFontSize(12);
                    doc.setTextColor(59, 130, 246);
                    doc.text('Meta Description:', 20, yPosition);
                    doc.setFontSize(10);
                    doc.setTextColor(55, 65, 81);
                    const metaLines = doc.splitTextToSize(generatedContent.metadata.metaDescription, 170);
                    doc.text(metaLines, 20, yPosition + 5);
                    yPosition += 5 + (metaLines.length * 5);
                }
                
                if (generatedContent.metadata?.keywords?.length) {
                    yPosition += 10;
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.setFontSize(12);
                    doc.setTextColor(59, 130, 246);
                    doc.text('Mots-cl√©s:', 20, yPosition);
                    doc.setFontSize(10);
                    doc.setTextColor(55, 65, 81);
                    doc.text(generatedContent.metadata.keywords.join(', '), 20, yPosition + 5);
                }
                
                // Add footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(156, 163, 175);
                    doc.text(`Page ${i} sur ${pageCount}`, 105, 290, { align: 'center' });
                    doc.text('Cr√©√© avec SEO Platform', 105, 295, { align: 'center' });
                }
                
                // Save PDF
                const filename = `seo-content-${Date.now()}.pdf`;
                doc.save(filename);
                
                window.showNotification('PDF export√© avec succ√®s !', 'success');
            } catch (error) {
                console.error('PDF export error:', error);
                window.showNotification('Erreur lors de l\'export PDF', 'error');
            } finally {
                window.hideLoading();
            }
        }

        async function exportContentItemAsPDF(contentId) {
            window.showLoading('Chargement du contenu...');

            try {
                const response = await fetch(`${API_URL}/api/content/${contentId}`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const data = await response.json();
                
                if (data.success && data.content) {
                    generatedContent = data.content;
                    await exportContentAsPDF();
                } else {
                    window.showNotification('Contenu introuvable', 'error');
                }
            } catch (error) {
                console.error('Load content error:', error);
                window.showNotification('Erreur de chargement', 'error');
            } finally {
                window.hideLoading();
            }
        }

        window.exportAnalyticsReport = async function() {
            window.showLoading('G√©n√©ration du rapport PDF...');

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.setTextColor(59, 130, 246);
                doc.text('Rapport d\'Analyse SEO', 20, 20);
                
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text(`G√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')} √† ${new Date().toLocaleTimeString('fr-FR')}`, 20, 30);
                
                doc.setDrawColor(59, 130, 246);
                doc.setLineWidth(0.5);
                doc.line(20, 35, 190, 35);
                
                // Organization info
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.text(`Organisation: ${currentUser.organization?.name || 'N/A'}`, 20, 45);
                doc.text(`Utilisateur: ${currentUser.firstName} ${currentUser.lastName}`, 20, 52);
                
                // Stats
                let yPos = 65;
                doc.setFontSize(14);
                doc.setTextColor(59, 130, 246);
                doc.text('Statistiques Globales', 20, yPos);
                
                yPos += 10;
                doc.setFontSize(11);
                doc.setTextColor(0, 0, 0);
                doc.text(`Sites Web: ${document.getElementById('statsWebsites').textContent}`, 30, yPos);
                yPos += 7;
                doc.text(`Contenus G√©n√©r√©s: ${document.getElementById('statsContents').textContent}`, 30, yPos);
                yPos += 7;
                doc.text(`Pages Analys√©es: ${document.getElementById('statsAnalytics').textContent}`, 30, yPos);
                yPos += 7;
                doc.text(`Utilisateurs: ${document.getElementById('statsUsers').textContent}`, 30, yPos);
                
                // Footer
                doc.setFontSize(8);
                doc.setTextColor(156, 163, 175);
                doc.text('SEO Platform - Multi-User, Multi-Site, Multi-Language', 105, 290, { align: 'center' });
                
                // Save
                const filename = `seo-report-${Date.now()}.pdf`;
                doc.save(filename);
                
                window.showNotification('Rapport PDF export√© !', 'success');
            } catch (error) {
                console.error('Export report error:', error);
                window.showNotification('Erreur lors de l\'export', 'error');
            } finally {
                window.hideLoading();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìà ANALYTICS FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.loadAnalytics = async function() {
            const analyticsSelect = document.getElementById('analyticsWebsite');
            const websiteId = analyticsSelect?.value || '';
            
            console.log('üìä [loadAnalytics] Starting...');
            console.log('üìä [loadAnalytics] Dropdown element:', analyticsSelect);
            console.log('üìä [loadAnalytics] Dropdown value:', websiteId);
            console.log('üìä [loadAnalytics] Dropdown innerHTML length:', analyticsSelect?.innerHTML?.length || 0);
            
            try {
                console.log('üìä Loading analytics for websiteId:', websiteId || 'ALL');
                
                // Construire l'URL avec dates (30 jours + lendemain pour inclure toutes les donn√©es)
                const startDate = new Date(Date.now() - 30 * 24 * 3600000).toISOString().split('T')[0];
                const endDate = new Date(Date.now() + 1 * 24 * 3600000).toISOString().split('T')[0]; // +1 jour
                
                console.log('üìä Date range:', startDate, '‚Üí', endDate);
                
                let allAnalytics = [];
                
                if (!websiteId || websiteId === '') {
                    // Charger TOUS les sites et leurs analytics
                    console.log('üìä Loading ALL sites analytics...');
                    
                    const websitesResponse = await fetch(`${API_URL}/api/websites`, {
                        headers: { 'Authorization': `Bearer ${currentToken}` }
                    });
                    const websitesData = await websitesResponse.json();
                    const websites = websitesData.websites || [];
                    
                    console.log('üìä Websites response:', websitesData);
                    
                    if (websites.length === 0) {
                        document.getElementById('analyticsData').innerHTML = 
                            '<p class="text-gray-500 text-center py-8">Aucun site disponible. Cr√©ez un site d\'abord.</p>';
                        return;
                    }
                    
                    console.log(`üìä Found ${websites.length} site(s)`);
                    
                    // Charger les analytics pour chaque site
                    for (const site of websites) {
                        console.log(`üìä Loading analytics for site: ${site.name} (_id: ${site._id})`);
                        
                        const url = `${API_URL}/api/analytics?websiteId=${site._id}&startDate=${startDate}&endDate=${endDate}`;
                        console.log(`üìä Fetching: ${url}`);
                        
                        const response = await fetch(url, {
                            headers: { 'Authorization': `Bearer ${currentToken}` }
                        });
                        
                        console.log(`üìä Response status for ${site.name}:`, response.status);
                        
                        if (response.ok) {
                            const data = await response.json();
                            const analytics = Array.isArray(data) ? data : (data.analytics || []);
                            
                            // Ajouter le nom du site √† chaque analytics
                            analytics.forEach(a => {
                                a.siteName = site.name;
                                a.siteUrl = site.url;
                            });
                            
                            allAnalytics = allAnalytics.concat(analytics);
                            console.log(`‚úÖ Loaded ${analytics.length} analytics for ${site.name}`);
                        } else {
                            console.error(`‚ùå Failed to load analytics for ${site.name}:`, response.status);
                        }
                    }
                    for (const site of websites) {
                        const url = `${API_URL}/api/analytics?websiteId=${site._id}&startDate=${startDate}&endDate=${endDate}`;
                        const response = await fetch(url, {
                            headers: { 'Authorization': `Bearer ${currentToken}` }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            const analytics = Array.isArray(data) ? data : (data.analytics || []);
                            
                            // Ajouter le nom du site √† chaque analytics
                            analytics.forEach(a => {
                                a.siteName = site.name;
                                a.siteUrl = site.url;
                            });
                            
                            allAnalytics = allAnalytics.concat(analytics);
                            console.log(`‚úÖ Loaded ${analytics.length} analytics for ${site.name}`);
                        }
                    }
                } else {
                    // Charger UN site sp√©cifique
                    console.log('üìä Loading analytics for specific site:', websiteId);
                    
                    const url = `${API_URL}/api/analytics?websiteId=${websiteId}&startDate=${startDate}&endDate=${endDate}`;
                    const response = await fetch(url, {
                        headers: { 'Authorization': `Bearer ${currentToken}` }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    allAnalytics = Array.isArray(data) ? data : (data.analytics || []);
                    console.log(`‚úÖ Loaded ${allAnalytics.length} analytics`);
                }
                
                console.log('üìä Total analytics:', allAnalytics.length);
                
                // Afficher les analytics
                if (allAnalytics.length > 0) {
                    // Grouper par site et par page
                    const groupedBySite = {};
                    
                    allAnalytics.forEach(item => {
                        const siteName = item.siteName || 'Site inconnu';
                        const pageUrl = item.pageUrl || '/';
                        
                        if (!groupedBySite[siteName]) {
                            groupedBySite[siteName] = {};
                        }
                        
                        if (!groupedBySite[siteName][pageUrl]) {
                            groupedBySite[siteName][pageUrl] = {
                                pageviews: 0,
                                clicks: 0,
                                count: 0
                            };
                        }
                        
                        groupedBySite[siteName][pageUrl].count++;
                        
                        if (item.event?.type === 'pageview') {
                            groupedBySite[siteName][pageUrl].pageviews++;
                        } else if (item.event?.type === 'click') {
                            groupedBySite[siteName][pageUrl].clicks++;
                        }
                    });
                    
                    // Construire le HTML
                    let analyticsHTML = '';
                    
                    Object.entries(groupedBySite).forEach(([siteName, pages]) => {
                        // Si plusieurs sites, afficher le nom du site
                        if (Object.keys(groupedBySite).length > 1) {
                            analyticsHTML += `
                                <div class="mb-6">
                                    <h2 class="text-2xl font-bold text-gray-900 mb-4">üìä ${siteName}</h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            `;
                        } else {
                            analyticsHTML += `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">`;
                        }
                        
                        Object.entries(pages).forEach(([pageUrl, stats]) => {
                            analyticsHTML += `
                                <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition-shadow">
                                    <h3 class="text-lg font-bold text-gray-900 mb-4 truncate" title="${pageUrl}">${pageUrl}</h3>
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <p class="text-sm text-gray-600">Pages vues</p>
                                            <p class="text-2xl font-bold text-blue-600">${stats.pageviews}</p>
                                        </div>
                                        <div>
                                            <p class="text-sm text-gray-600">Clics</p>
                                            <p class="text-2xl font-bold text-green-600">${stats.clicks}</p>
                                        </div>
                                    </div>
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <p class="text-sm text-gray-600">Total √©v√©nements</p>
                                        <p class="text-xl font-bold text-gray-900">${stats.count}</p>
                                    </div>
                                </div>
                            `;
                        });
                        
                        analyticsHTML += `</div>`;
                        
                        if (Object.keys(groupedBySite).length > 1) {
                            analyticsHTML += `</div>`;
                        }
                    });
                    
                    // Ajouter un r√©sum√© global
                    const totalEvents = allAnalytics.length;
                    const totalPageviews = allAnalytics.filter(a => a.event?.type === 'pageview').length;
                    const totalClicks = allAnalytics.filter(a => a.event?.type === 'click').length;
                    
                    const summaryHTML = `
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-6 mb-6 text-white">
                            <h2 class="text-2xl font-bold mb-4">üìà R√©sum√© Global</h2>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <p class="text-blue-100 text-sm">Total √©v√©nements</p>
                                    <p class="text-3xl font-bold">${totalEvents}</p>
                                </div>
                                <div>
                                    <p class="text-blue-100 text-sm">Pages vues</p>
                                    <p class="text-3xl font-bold">${totalPageviews}</p>
                                </div>
                                <div>
                                    <p class="text-blue-100 text-sm">Clics</p>
                                    <p class="text-3xl font-bold">${totalClicks}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('analyticsData').innerHTML = summaryHTML + analyticsHTML;
                    
                    console.log('‚úÖ Analytics displayed:', {
                        sites: Object.keys(groupedBySite).length,
                        totalEvents: totalEvents,
                        pageviews: totalPageviews,
                        clicks: totalClicks
                    });
                } else {
                    document.getElementById('analyticsData').innerHTML = 
                        '<p class="text-gray-500 text-center py-8">Aucune donn√©e d\'analyse disponible. Le pixel n\'a pas encore enregistr√© de donn√©es.</p>';
                }
            } catch (error) {
                console.error('‚ùå Load analytics error:', error);
                document.getElementById('analyticsData').innerHTML = 
                    `<p class="text-red-500 text-center py-8">Erreur de chargement: ${error.message}</p>`;
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üë• USERS FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.loadUsers = async function() {
            try {
                const response = await fetch(`${API_URL}/api/users`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                const data = await response.json();
                
                if (data.success && data.users) {
                    const usersHTML = `
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Utilisateur</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">R√¥le</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Statut</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${data.users.map(user => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4">
                                            <div class="font-medium text-gray-900">${user.firstName} ${user.lastName}</div>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-500">${user.email}</td>
                                        <td class="px-6 py-4">
                                            <span class="px-2 py-1 text-xs font-semibold rounded ${getRoleBadgeClass(user.role)}">
                                                ${getRoleText(user.role)}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span class="px-2 py-1 text-xs font-semibold rounded ${user.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                                ${user.isActive ? 'Actif' : 'Inactif'}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            ${user._id !== currentUser._id ? `
                                                <button onclick="window.deleteUser('${user._id}')" class="text-red-600 hover:text-red-800 text-sm font-medium">
                                                    Supprimer
                                                </button>
                                            ` : '<span class="text-gray-400 text-sm">Vous</span>'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    
                    document.getElementById('usersList').innerHTML = usersHTML;
                }
            } catch (error) {
                console.error('Load users error:', error);
                document.getElementById('usersList').innerHTML = 
                    '<p class="text-gray-500 text-center py-8">Erreur de chargement</p>';
            }
        }

        window.inviteUser = async function() {
            const email = document.getElementById('inviteUserEmail').value;
            const firstName = document.getElementById('inviteUserFirstName').value;
            const lastName = document.getElementById('inviteUserLastName').value;
            const role = document.getElementById('inviteUserRole').value;

            if (!email || !firstName || !lastName) {
                window.showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }

            window.showLoading('Invitation en cours...');

            try {
                const response = await fetch(`${API_URL}/api/users/invite`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify({ email, firstName, lastName, role })
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification('Utilisateur invit√© avec succ√®s !', 'success');
                    closeInviteUserModal();
                    await loadUsers();
                } else {
                    window.showNotification(data.error || 'Erreur lors de l\'invitation', 'error');
                }
            } catch (error) {
                console.error('Invite user error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }

        async function deleteUser(userId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet utilisateur ?')) return;

            window.showLoading('Suppression...');

            try {
                const response = await fetch(`${API_URL}/api/users/${userId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification('Utilisateur supprim√©', 'success');
                    await loadUsers();
                } else {
                    window.showNotification(data.error || 'Erreur lors de la suppression', 'error');
                }
            } catch (error) {
                console.error('Delete user error:', error);
                window.showNotification('Erreur de connexion au serveur', 'error');
            } finally {
                window.hideLoading();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ‚öôÔ∏è INSTALLATION/PIXEL FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.generatePixelCode = function() {
            const websiteId = document.getElementById('installationWebsite').value;
            
            if (!websiteId) {
                document.getElementById('pixelCode').innerHTML = '<code>// S√©lectionnez d\'abord un site</code>';
                return;
            }

            const website = window.currentWebsites?.find(w => w._id === websiteId);
            const siteId = website?.siteId || websiteId;

            const scriptOpen = '<' + 'script>';
            const scriptClose = '<' + '/script>';

            const pixelCode = `<!-- SEO Pixel Configuration -->
${scriptOpen}
window.seoPixelConfig = {
    siteId: '${siteId}',
    apiEndpoint: '${API_URL}',
    brand: '${website?.name || 'Votre Marque'}',
    debug: false  // true pour dev, false pour production
};
${scriptClose}

<!-- SEO Pixel Script -->
${scriptOpen} src="${API_URL.replace('/api', '')}/seo-pixel.js"${scriptClose}`;

            document.getElementById('pixelCode').innerHTML = `<code>${escapeHtml(pixelCode)}</code>`;
        }

        window.copyPixelCode = function() {
            const code = document.getElementById('pixelCode').textContent;
            
            if (code.includes('S√©lectionnez')) {
                window.showNotification('Veuillez d\'abord s√©lectionner un site', 'error');
                return;
            }
            
            navigator.clipboard.writeText(code).then(() => {
                window.showNotification('Code copi√© dans le presse-papier !', 'success');
            }).catch(() => {
                window.showNotification('Erreur lors de la copie', 'error');
            });
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéØ MODAL DE CODE PIXEL (NOUVEAU)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        /**
         * Afficher la modal avec le code pixel pour un site
         */
        window.showPixelCodeModal = function(website) {
            if (!website || !website._id) {
                console.error('Website data is missing');
                return;
            }

            // Remplir les informations du site
            document.getElementById('modalSiteName').textContent = website.name || '-';
            document.getElementById('modalSiteUrl').textContent = website.url || '-';
            document.getElementById('modalSiteLanguage').textContent = window.getLanguageFlag(website.language) + ' ' + website.language.toUpperCase();
            document.getElementById('modalSiteId').textContent = website._id;

            // G√©n√©rer le code pixel
            const pixelCode = generatePixelCodeForSite(website._id);
            document.getElementById('modalPixelCode').textContent = pixelCode;

            // Afficher la modal
            document.getElementById('pixelCodeModal').classList.remove('hidden');
        }

        /**
         * Fermer la modal de code pixel
         */
        window.closePixelCodeModal = function() {
            document.getElementById('pixelCodeModal').classList.add('hidden');
        }

        /**
         * Copier le code pixel depuis la modal
         */
        window.copyModalPixelCode = function() {
            const code = document.getElementById('modalPixelCode').textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                window.showNotification('‚úÖ Code copi√© dans le presse-papier !', 'success');
            }).catch(() => {
                window.showNotification('‚ùå Erreur lors de la copie', 'error');
            });
        }

        /**
         * Aller √† l'onglet installation
         */
        window.goToInstallationTab = function() {
            window.closePixelCodeModal();
            window.switchTab('installation');
        }

        /**
         * Afficher le code pixel pour un site existant (via le bouton sur la carte)
         */
        window.showPixelCodeForWebsite = function(websiteId) {
            // Trouver le site dans la liste actuelle
            const website = window.currentWebsites?.find(w => w._id === websiteId);
            
            if (website) {
                window.showPixelCodeModal(website);
            } else {
                // Si on n'a pas le site en cache, faire une requ√™te
                window.showLoading('Chargement...');
                fetch(`${API_URL}/api/websites/${websiteId}`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                })
                .then(r => r.json())
                .then(data => {
                    window.hideLoading();
                    if (data.success && data.website) {
                        window.showPixelCodeModal(data.website);
                    } else {
                        window.showNotification('Site introuvable', 'error');
                    }
                })
                .catch(error => {
                    window.hideLoading();
                    console.error('Error fetching website:', error);
                    window.showNotification('Erreur lors du chargement', 'error');
                });
            }
        }

        /**
         * G√©n√©rer le code pixel pour un site sp√©cifique
         */
        function generatePixelCodeForSite(websiteId) {
            const website = window.currentWebsites?.find(w => w._id === websiteId);
            const siteId = website?.siteId || websiteId;
            
            const scriptOpen = '<' + 'script>';
            const scriptClose = '<' + '/script>';
            
            return `<!-- SEO Pixel Configuration -->
${scriptOpen}
window.seoPixelConfig = {
    siteId: '${siteId}',
    apiEndpoint: '${API_URL}',
    brand: '${website?.name || 'Votre Marque'}',
    debug: false  // true pour dev, false pour production
};
${scriptClose}

<!-- SEO Pixel Script -->
${scriptOpen} src="${API_URL.replace('/api', '')}/seo-pixel.js"${scriptClose}`;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üé® UI HELPER FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function switchTab(tabName) {
            currentTab = tabName;
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('tab-active');
            });
            
            // Show selected tab
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            
            // Add active class to selected button
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.classList.add('tab-active');
            }
            
            // Load tab-specific data
            switch(tabName) {
                case 'websites':
                    loadWebsites();
                    break;
                case 'content':
                    loadWebsites();
                    loadContents();
                    break;
                case 'analytics':
                    console.log('üîÑ Loading Analytics tab...');
                    loadWebsites().then(() => {
                        console.log('‚úÖ Websites loaded:', window.currentWebsites?.length || 0);
                        
                        // Populer le dropdown des sites
                        const analyticsSelect = document.getElementById('analyticsWebsite');
                        if (analyticsSelect && window.currentWebsites && window.currentWebsites.length > 0) {
                            const currentValue = analyticsSelect.value;
                            analyticsSelect.innerHTML = '<option value="">Tous les sites</option>' +
                                window.currentWebsites.map(w => 
                                    `<option value="${w._id}">${escapeHtml(w.name)}</option>`
                                ).join('');
                            if (currentValue) analyticsSelect.value = currentValue;
                            
                            console.log('‚úÖ Dropdown populated with', window.currentWebsites.length, 'sites');
                        } else {
                            console.warn('‚ö†Ô∏è No websites found or dropdown not available');
                        }
                        
                        // Attendre un peu pour √™tre s√ªr que le DOM est √† jour
                        setTimeout(() => {
                            console.log('üöÄ Now loading analytics...');
                            loadAnalytics();
                        }, 100);
                    }).catch(err => {
                        console.error('‚ùå Error loading websites:', err);
                        document.getElementById('analyticsData').innerHTML = 
                            '<p class="text-red-500 text-center py-8">Erreur de chargement des sites</p>';
                    });
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'seopixel':
                    loadWebsites();
                    loadSEORules();
                    // Populate website selects
                    setTimeout(() => {
                        if (window.currentWebsites) {
                            const selects = ['pixelWebsiteSelect', 'ruleWebsiteFilter', 'ruleWebsite'];
                            selects.forEach(selectId => {
                                const select = document.getElementById(selectId);
                                if (select) {
                                    const currentValue = select.value;
                                    select.innerHTML = '<option value="">Choisir un site...</option>' +
                                        window.currentWebsites.map(w => 
                                            `<option value="${w._id}">${escapeHtml(w.name)}</option>`
                                        ).join('');
                                    if (currentValue) select.value = currentValue;
                                }
                            });
                        }
                    }, 100);
                    break;
                case 'installation':
                    loadWebsites();
                    // Populate website select
                    setTimeout(() => {
                        if (window.currentWebsites) {
                            const select = document.getElementById('installationWebsite');
                            if (select) {
                                const currentValue = select.value;
                                select.innerHTML = '<option value="">Choisir un site...</option>' +
                                    window.currentWebsites.map(w => 
                                        `<option value="${w._id}">${escapeHtml(w.name)}</option>`
                                    ).join('');
                                if (currentValue) select.value = currentValue;
                            }
                        }
                    }, 100);
                    break;
            }
        }

        window.showAddWebsiteModal = function() {
            document.getElementById('addWebsiteModal').classList.remove('hidden');
        }

        window.closeAddWebsiteModal = function() {
            document.getElementById('addWebsiteModal').classList.add('hidden');
            document.getElementById('newWebsiteName').value = '';
            document.getElementById('newWebsiteUrl').value = '';
        }

        window.showInviteUserModal = function() {
            document.getElementById('inviteUserModal').classList.remove('hidden');
        }

        window.closeInviteUserModal = function() {
            document.getElementById('inviteUserModal').classList.add('hidden');
            document.getElementById('inviteUserEmail').value = '';
            document.getElementById('inviteUserFirstName').value = '';
            document.getElementById('inviteUserLastName').value = '';
        }

        window.showLoading = function(text = 'Chargement...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        window.hideLoading = function() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        window.showNotification = function(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-fade-in`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üîß UTILITY FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.getLanguageFlag = function(language) {
            const flags = {
                'en': 'üá¨üáß',
                'fr': 'üá´üá∑',
                'es': 'üá™üá∏',
                'de': 'üá©üá™',
                'it': 'üáÆüáπ',
                'pt': 'üáµüáπ',
                'nl': 'üá≥üá±',
                'ru': 'üá∑üá∫',
                'ja': 'üáØüáµ',
                'zh': 'üá®üá≥'
            };
            return flags[language] || 'üåê';
        }

        window.getActivityIcon = function(type) {
            const icons = {
                'content': '‚úçÔ∏è',
                'website': 'üåê',
                'user': 'üë•',
                'analytics': 'üìä'
            };
            return icons[type] || 'üìå';
        }

        window.getRoleText = function(role) {
            const roles = {
                'admin': 'üëë Admin',
                'user': 'üë§ Utilisateur',
                'viewer': 'üëÅÔ∏è Observateur'
            };
            return roles[role] || role;
        }

        window.getRoleBadgeClass = function(role) {
            const classes = {
                'admin': 'bg-purple-100 text-purple-800',
                'user': 'bg-blue-100 text-blue-800',
                'viewer': 'bg-gray-100 text-gray-800'
            };
            return classes[role] || 'bg-gray-100 text-gray-800';
        }

        window.formatDate = function(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        window.escapeHtml = function(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéØ SEO PIXEL MANAGEMENT FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        window.generateSEOPixelCode = function() {
            const websiteSelect = document.getElementById('pixelWebsiteSelect');
            const websiteId = websiteSelect.value;
            
            if (!websiteId) {
                document.getElementById('pixelCodeSection').style.display = 'none';
                return;
            }

            const website = window.currentWebsites?.find(w => w._id === websiteId);
            const siteId = website?.siteId || websiteId;

            const scriptOpen = '<' + 'script>';
            const scriptClose = '<' + '/script>';

            const pixelCode = `<!-- SEO Pixel Configuration -->
${scriptOpen}
window.seoPixelConfig = {
    siteId: '${siteId}',
    apiEndpoint: '${API_URL}',
    brand: '${website?.name || 'Votre Marque'}',
    debug: false  // true pour dev, false pour production
};
${scriptClose}

<!-- SEO Pixel Script -->
${scriptOpen} src="${API_URL.replace('/api', '')}/seo-pixel.js"${scriptClose}`;

            document.getElementById('seoPixelCodeDisplay').textContent = pixelCode;
            document.getElementById('pixelCodeSection').style.display = 'block';
        }

        window.copySEOPixelCode = function() {
            const websiteId = document.getElementById('pixelWebsiteSelect').value;
            
            if (!websiteId) {
                window.showNotification('Veuillez d\'abord s√©lectionner un site', 'error');
                return;
            }

            const code = document.getElementById('seoPixelCodeDisplay').textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                window.showNotification('‚úÖ Code SEO Pixel copi√© !', 'success');
            }).catch(() => {
                window.showNotification('‚ùå Erreur lors de la copie', 'error');
            });
        }

        window.loadSEORules = async function() {
            const websiteFilter = document.getElementById('ruleWebsiteFilter').value;
            
            try {
                let url = `${API_URL}/api/seo-rules`;
                if (websiteFilter) {
                    url += `?websiteId=${websiteFilter}`;
                }

                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();

                if (data.success && data.rules) {
                    displaySEORules(data.rules);
                } else {
                    document.getElementById('seoRulesList').innerHTML = 
                        '<p class="text-gray-500 text-center py-8">Aucune r√®gle SEO trouv√©e</p>';
                }
            } catch (error) {
                console.error('Load SEO rules error:', error);
                window.showNotification('Erreur lors du chargement des r√®gles', 'error');
            }
        }

        function displaySEORules(rules) {
            if (rules.length === 0) {
                document.getElementById('seoRulesList').innerHTML = 
                    '<p class="text-gray-500 text-center py-8">Aucune r√®gle SEO pour le moment</p>';
                return;
            }

            const rulesHtml = rules.map(rule => {
                const statusColors = {
                    active: 'bg-green-100 text-green-800',
                    inactive: 'bg-gray-100 text-gray-800',
                    draft: 'bg-yellow-100 text-yellow-800',
                    testing: 'bg-blue-100 text-blue-800'
                };

                const statusColor = statusColors[rule.status] || 'bg-gray-100 text-gray-800';

                return `
                    <div class="border-b border-gray-200 p-4 hover:bg-gray-50">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h4 class="font-bold text-gray-900">${escapeHtml(rule.name)}</h4>
                                    <span class="px-2 py-1 rounded-full text-xs font-semibold ${statusColor}">
                                        ${rule.status}
                                    </span>
                                    <span class="text-xs text-gray-500">
                                        Priorit√©: ${rule.priority}
                                    </span>
                                </div>
                                ${rule.description ? `<p class="text-sm text-gray-600 mb-2">${escapeHtml(rule.description)}</p>` : ''}
                                <div class="flex items-center gap-4 text-xs text-gray-500">
                                    <span>üéØ ${rule.targeting.matchType}: ${escapeHtml(rule.targeting.urlPattern)}</span>
                                    <span>üìä ${rule.stats?.impressions || 0} impressions</span>
                                    ${rule.abTesting?.enabled ? '<span>üß™ A/B Testing actif</span>' : ''}
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="window.toggleRuleStatus('${rule._id}', '${rule.status}')" 
                                        class="px-3 py-1 text-sm rounded-lg ${rule.status === 'active' ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-green-100 text-green-700 hover:bg-green-200'}">
                                    ${rule.status === 'active' ? '‚è∏Ô∏è D√©sactiver' : '‚ñ∂Ô∏è Activer'}
                                </button>
                                <button onclick="window.editSEORule('${rule._id}')" 
                                        class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200">
                                    ‚úèÔ∏è Modifier
                                </button>
                                <button onclick="window.deleteSEORule('${rule._id}')" 
                                        class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded-lg hover:bg-red-200">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('seoRulesList').innerHTML = rulesHtml;
        }

        window.toggleRuleStatus = async function(ruleId, currentStatus) {
            const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
            
            try {
                const response = await fetch(`${API_URL}/api/seo-rules/${ruleId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification(`R√®gle ${newStatus === 'active' ? 'activ√©e' : 'd√©sactiv√©e'}`, 'success');
                    loadSEORules();
                } else {
                    window.showNotification(data.error || 'Erreur', 'error');
                }
            } catch (error) {
                console.error('Toggle rule status error:', error);
                window.showNotification('Erreur lors de la modification', 'error');
            }
        }

        window.deleteSEORule = async function(ruleId) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette r√®gle ?')) return;

            try {
                const response = await fetch(`${API_URL}/api/seo-rules/${ruleId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification('R√®gle supprim√©e', 'success');
                    loadSEORules();
                } else {
                    window.showNotification(data.error || 'Erreur', 'error');
                }
            } catch (error) {
                console.error('Delete rule error:', error);
                window.showNotification('Erreur lors de la suppression', 'error');
            }
        }

        window.showCreateRuleModal = function(ruleId = null) {
            // Show the rule editor modal
            window.currentEditingRuleId = ruleId;
            
            if (ruleId) {
                // Load existing rule data
                loadRuleDataForEdit(ruleId);
            } else {
                // Reset form for new rule
                resetRuleEditorForm();
            }
            
            document.getElementById('ruleEditorModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        window.editSEORule = function(ruleId) {
            window.showCreateRuleModal(ruleId);
        }

        window.closeRuleModal = function() {
            document.getElementById('ruleEditorModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            window.currentEditingRuleId = null;
        }

        async function loadRuleDataForEdit(ruleId) {
            try {
                const response = await fetch(`${API_URL}/api/seo-rules/${ruleId}`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                const data = await response.json();
                
                if (data.success && data.rule) {
                    populateRuleEditor(data.rule);
                }
            } catch (error) {
                console.error('Load rule error:', error);
                window.showNotification('Erreur lors du chargement de la r√®gle', 'error');
            }
        }

        function resetRuleEditorForm() {
            document.getElementById('modalTitle').textContent = 'Cr√©er une R√®gle SEO';
            document.getElementById('ruleName').value = '';
            document.getElementById('ruleDescription').value = '';
            document.getElementById('ruleWebsite').value = '';
            document.getElementById('ruleMatchType').value = 'exact';
            document.getElementById('ruleUrlPattern').value = '';
            document.getElementById('rulePriority').value = '100';
            document.getElementById('ruleStatus').value = 'draft';
            
            // Reset all modification checkboxes and fields
            document.getElementById('modTitle').checked = false;
            document.getElementById('modMeta').checked = false;
            document.getElementById('modH1').checked = false;
            document.getElementById('modOG').checked = false;
            document.getElementById('modTwitter').checked = false;
            document.getElementById('modCanonical').checked = false;
            document.getElementById('modRobots').checked = false;
            document.getElementById('modSchema').checked = false;
            
            // Clear all text fields
            document.getElementById('titleAction').value = 'replace';
            document.getElementById('titleValue').value = '';
            document.getElementById('metaAction').value = 'replace';
            document.getElementById('metaValue').value = '';
            document.getElementById('h1Action').value = 'replace';
            document.getElementById('h1Value').value = '';
            
            updateModificationSections();
        }

        function populateRuleEditor(rule) {
            document.getElementById('modalTitle').textContent = 'Modifier la R√®gle SEO';
            document.getElementById('ruleName').value = rule.name || '';
            document.getElementById('ruleDescription').value = rule.description || '';
            document.getElementById('ruleWebsite').value = rule.websiteId || '';
            document.getElementById('ruleMatchType').value = rule.targeting?.matchType || 'exact';
            document.getElementById('ruleUrlPattern').value = rule.targeting?.urlPattern || '';
            document.getElementById('rulePriority').value = rule.priority || 100;
            document.getElementById('ruleStatus').value = rule.status || 'draft';
            
            // Populate modifications
            const mods = rule.modifications || {};
            
            if (mods.title?.enabled) {
                document.getElementById('modTitle').checked = true;
                document.getElementById('titleAction').value = mods.title.action || 'replace';
                document.getElementById('titleValue').value = mods.title.value || mods.title.template || '';
            }
            
            if (mods.metaDescription?.enabled) {
                document.getElementById('modMeta').checked = true;
                document.getElementById('metaAction').value = mods.metaDescription.action || 'replace';
                document.getElementById('metaValue').value = mods.metaDescription.value || '';
            }
            
            if (mods.h1?.enabled) {
                document.getElementById('modH1').checked = true;
                document.getElementById('h1Action').value = mods.h1.action || 'replace';
                document.getElementById('h1Value').value = mods.h1.value || '';
            }
            
            document.getElementById('modOG').checked = mods.openGraph?.enabled || false;
            document.getElementById('modTwitter').checked = mods.twitterCard?.enabled || false;
            document.getElementById('modCanonical').checked = mods.canonical?.enabled || false;
            document.getElementById('modRobots').checked = mods.robots?.enabled || false;
            document.getElementById('modSchema').checked = mods.structuredData?.enabled || false;
            
            updateModificationSections();
        }

        window.updateModificationSections = function() {
            // Show/hide modification sections based on checkboxes
            document.getElementById('titleSection').style.display = 
                document.getElementById('modTitle').checked ? 'block' : 'none';
            document.getElementById('metaSection').style.display = 
                document.getElementById('modMeta').checked ? 'block' : 'none';
            document.getElementById('h1Section').style.display = 
                document.getElementById('modH1').checked ? 'block' : 'none';
        }

        window.saveRule = async function() {
            const websiteId = document.getElementById('ruleWebsite').value;
            const name = document.getElementById('ruleName').value;
            const urlPattern = document.getElementById('ruleUrlPattern').value;
            
            if (!websiteId || !name || !urlPattern) {
                window.showNotification('Veuillez remplir tous les champs obligatoires', 'error');
                return;
            }
            
            const ruleData = {
                websiteId,
                name,
                description: document.getElementById('ruleDescription').value,
                targeting: {
                    matchType: document.getElementById('ruleMatchType').value,
                    urlPattern
                },
                modifications: {},
                priority: parseInt(document.getElementById('rulePriority').value),
                status: document.getElementById('ruleStatus').value
            };
            
            // Build modifications object
            if (document.getElementById('modTitle').checked) {
                const action = document.getElementById('titleAction').value;
                const value = document.getElementById('titleValue').value;
                ruleData.modifications.title = {
                    enabled: true,
                    action,
                    [action === 'template' ? 'template' : 'value']: value
                };
            }
            
            if (document.getElementById('modMeta').checked) {
                const action = document.getElementById('metaAction').value;
                ruleData.modifications.metaDescription = {
                    enabled: true,
                    action,
                    value: document.getElementById('metaValue').value
                };
            }
            
            if (document.getElementById('modH1').checked) {
                ruleData.modifications.h1 = {
                    enabled: true,
                    action: document.getElementById('h1Action').value,
                    value: document.getElementById('h1Value').value
                };
            }
            
            if (document.getElementById('modOG').checked) {
                ruleData.modifications.openGraph = {
                    enabled: true,
                    tags: [{ property: 'og:type', content: 'website' }]
                };
            }
            
            if (document.getElementById('modTwitter').checked) {
                ruleData.modifications.twitterCard = {
                    enabled: true,
                    tags: [{ name: 'twitter:card', content: 'summary_large_image' }]
                };
            }
            
            if (document.getElementById('modCanonical').checked) {
                ruleData.modifications.canonical = { enabled: true, action: 'set', useCurrentUrl: true };
            }
            
            if (document.getElementById('modRobots').checked) {
                ruleData.modifications.robots = { enabled: true, directives: ['index', 'follow'] };
            }
            
            if (document.getElementById('modSchema').checked) {
                ruleData.modifications.structuredData = {
                    enabled: true,
                    schemas: [{
                        type: 'WebPage',
                        data: { "@context": "https://schema.org", "@type": "WebPage" }
                    }]
                };
            }
            
            try {
                const url = window.currentEditingRuleId 
                    ? `${API_URL}/api/seo-rules/${window.currentEditingRuleId}`
                    : `${API_URL}/api/seo-rules`;
                
                const method = window.currentEditingRuleId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(ruleData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    window.showNotification(
                        window.currentEditingRuleId ? 'R√®gle mise √† jour !' : 'R√®gle cr√©√©e !', 
                        'success'
                    );
                    closeRuleModal();
                    loadSEORules();
                } else {
                    window.showNotification(data.error || 'Erreur lors de la sauvegarde', 'error');
                }
            } catch (error) {
                console.error('Save rule error:', error);
                window.showNotification('Erreur lors de la sauvegarde', 'error');
            }
        }

        window.createExampleRule = async function(type) {
            const websiteId = document.getElementById('pixelWebsiteSelect').value;
            
            if (!websiteId) {
                window.showNotification('Veuillez d\'abord s√©lectionner un site', 'error');
                return;
            }

            const examples = {
                homepage: {
                    name: 'Homepage - SEO Optimized',
                    description: 'Optimise le title et la meta description de la page d\'accueil',
                    targeting: {
                        matchType: 'exact',
                        urlPattern: '/'
                    },
                    modifications: {
                        title: {
                            enabled: true,
                            action: 'replace',
                            value: 'üèÜ Bienvenue sur Notre Site - N¬∞1 en France',
                            maxLength: 60
                        },
                        metaDescription: {
                            enabled: true,
                            action: 'replace',
                            value: 'D√©couvrez nos produits et services exceptionnels. ‚úì Livraison gratuite ‚úì Service client 7j/7',
                            maxLength: 160
                        }
                    },
                    status: 'active',
                    priority: 100
                },
                products: {
                    name: 'E-commerce - Pages Produits',
                    description: 'Optimise toutes les pages produits avec structured data',
                    targeting: {
                        matchType: 'starts_with',
                        urlPattern: '/products/'
                    },
                    modifications: {
                        title: {
                            enabled: true,
                            action: 'template',
                            template: '{original} | Achat en ligne - Livraison 24h'
                        },
                        openGraph: {
                            enabled: true,
                            tags: [
                                { property: 'og:type', content: 'product' }
                            ]
                        }
                    },
                    status: 'active',
                    priority: 80
                },
                blog: {
                    name: 'Blog - Articles SEO',
                    description: 'Ajoute Schema.org Article aux posts de blog',
                    targeting: {
                        matchType: 'starts_with',
                        urlPattern: '/blog/'
                    },
                    modifications: {
                        title: {
                            enabled: true,
                            action: 'append',
                            value: ' | Blog Expert'
                        },
                        structuredData: {
                            enabled: true,
                            schemas: [{
                                type: 'Article',
                                data: {
                                    "@context": "https://schema.org",
                                    "@type": "BlogPosting"
                                }
                            }]
                        }
                    },
                    status: 'active',
                    priority: 70
                }
            };

            const ruleData = examples[type];
            if (!ruleData) return;

            try {
                window.showLoading('Cr√©ation de la r√®gle...');

                const response = await fetch(`${API_URL}/api/seo-rules`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ...ruleData,
                        websiteId
                    })
                });

                const data = await response.json();

                if (data.success) {
                    window.showNotification('‚úÖ R√®gle cr√©√©e avec succ√®s !', 'success');
                    loadSEORules();
                } else {
                    window.showNotification(data.error || 'Erreur', 'error');
                }
            } catch (error) {
                console.error('Create example rule error:', error);
                window.showNotification('Erreur lors de la cr√©ation', 'error');
            } finally {
                window.hideLoading();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üöÄ INITIALIZATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Check if user is already logged in
        window.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                currentToken = token;
                currentUser = JSON.parse(user);
                showDashboard();
            }
        });

        // Handle Enter key in login forms
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (!document.getElementById('loginForm').classList.contains('hidden')) {
                    login();
                } else if (!document.getElementById('registerForm').classList.contains('hidden')) {
                    register();
                }
            }
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üìä SEO ANALYSIS FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let currentSEOAnalyses = [];
        let currentAnalysisId = null;
        let currentRecommendationIndex = null;

        // Load SEO Analyses
        window.loadSEOAnalyses = async function() {
            const websiteId = document.getElementById('seoWebsiteFilter')?.value || '';
            
            try {
                showLoading('Chargement des analyses SEO...');
                
                let url = `${API_URL}/api/seo/analyses?limit=20`;
                if (websiteId) url += `&websiteId=${websiteId}`;
                
                const response = await fetch(url, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                hideLoading();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                currentSEOAnalyses = data.analyses || [];
                
                renderSEODashboard(currentSEOAnalyses, data.summary);
                
            } catch (error) {
                hideLoading();
                console.error('‚ùå Load SEO analyses error:', error);
                document.getElementById('seoContent').innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-xl p-8 text-center">
                        <p class="text-red-800">Erreur de chargement des analyses SEO</p>
                        <p class="text-red-600 text-sm mt-2">${error.message}</p>
                    </div>
                `;
            }
        }

        // Render SEO Dashboard
        function renderSEODashboard(analyses, summary) {
            const content = document.getElementById('seoContent');
            
            if (analyses.length === 0) {
                content.innerHTML = `
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-12 text-center">
                        <svg class="w-24 h-24 mx-auto mb-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4">Aucune analyse SEO</h3>
                        <p class="text-gray-600 mb-6">Lancez votre premi√®re analyse pour obtenir des recommandations personnalis√©es.</p>
                        <button onclick="runSEOAnalysis()" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-lg">
                            üîç Analyser une page
                        </button>
                    </div>
                `;
                return;
            }
            
            const avgScore = summary?.avgScore || 0;
            const criticalIssues = summary?.criticalIssues || 0;
            const warnings = summary?.warnings || 0;
            
            const statsHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white stats-card">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-blue-100 text-sm font-medium">Score Moyen</p>
                            <svg class="w-8 h-8 text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <p class="text-5xl font-bold mb-1">${avgScore}<span class="text-2xl">/100</span></p>
                        <p class="text-blue-100 text-xs">${analyses.length} page(s) analys√©e(s)</p>
                    </div>

                    <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white stats-card">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-red-100 text-sm font-medium">Probl√®mes Critiques</p>
                            <svg class="w-8 h-8 text-red-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <p class="text-5xl font-bold mb-1">${criticalIssues}</p>
                        <p class="text-red-100 text-xs">√Ä corriger en priorit√©</p>
                    </div>

                    <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white stats-card">
                        <div class="flex items-center justify-between mb-2">
                            <p class="text-orange-100 text-sm font-medium">Avertissements</p>
                            <svg class="w-8 h-8 text-orange-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <p class="text-5xl font-bold mb-1">${warnings}</p>
                        <p class="text-orange-100 text-xs">Am√©liorations possibles</p>
                    </div>
                </div>
            `;
            
            const analysesHTML = `
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                        <h3 class="text-lg font-bold text-gray-900">üìã Analyses R√©centes</h3>
                    </div>
                    <div class="divide-y divide-gray-200">
                        ${analyses.map(analysis => renderAnalysisCard(analysis)).join('')}
                    </div>
                </div>
            `;
            
            content.innerHTML = statsHTML + analysesHTML;
            populateSEOWebsiteFilter();
        }

        // Render Analysis Card
        function renderAnalysisCard(analysis) {
            const score = analysis.score.overall;
            const scoreColor = score >= 80 ? 'green' : score >= 60 ? 'yellow' : score >= 40 ? 'orange' : 'red';
            const scoreGradient = {
                green: 'from-green-500 to-green-600',
                yellow: 'from-yellow-500 to-yellow-600',
                orange: 'from-orange-500 to-orange-600',
                red: 'from-red-500 to-red-600'
            }[scoreColor];
            
            const criticalCount = analysis.issues.filter(i => i.severity === 'critical').length;
            const warningCount = analysis.issues.filter(i => i.severity === 'warning').length;
            
            const date = new Date(analysis.timestamp);
            const timeAgo = getTimeAgo(date);
            
            return `
                <div class="p-6 hover:bg-gray-50 transition-colors cursor-pointer" onclick="viewSEODetails('${analysis._id}')">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h4 class="text-lg font-bold text-gray-900">${analysis.websiteId?.name || 'Site'}</h4>
                                <span class="text-xs text-gray-500">${timeAgo}</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">${analysis.url}</p>
                            
                            <div class="flex flex-wrap gap-2 mb-3">
                                ${renderScoreBadge('Meta', analysis.score.meta)}
                                ${renderScoreBadge('Contenu', analysis.score.content)}
                                ${renderScoreBadge('Structure', analysis.score.structure)}
                                ${renderScoreBadge('Perf', analysis.score.performance)}
                                ${renderScoreBadge('Mobile', analysis.score.mobile)}
                            </div>
                            
                            <div class="flex gap-4">
                                ${criticalCount > 0 ? `
                                    <span class="text-xs px-2 py-1 bg-red-100 text-red-800 rounded-full font-medium">
                                        ${criticalCount} critique${criticalCount > 1 ? 's' : ''}
                                    </span>
                                ` : ''}
                                ${warningCount > 0 ? `
                                    <span class="text-xs px-2 py-1 bg-orange-100 text-orange-800 rounded-full font-medium">
                                        ${warningCount} warning${warningCount > 1 ? 's' : ''}
                                    </span>
                                ` : ''}
                                ${analysis.recommendations?.length > 0 ? `
                                    <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full font-medium">
                                        ${analysis.recommendations.length} recommandation${analysis.recommendations.length > 1 ? 's' : ''}
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="flex flex-col items-center ml-6">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-br ${scoreGradient} flex items-center justify-center shadow-lg">
                                <div class="text-center">
                                    <p class="text-3xl font-bold text-white">${score}</p>
                                    <p class="text-xs text-white opacity-90">/ 100</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2 font-medium">Score SEO</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderScoreBadge(label, score) {
            const color = score >= 80 ? 'green' : score >= 60 ? 'blue' : score >= 40 ? 'orange' : 'red';
            const bgColor = {
                green: 'bg-green-100 text-green-800',
                blue: 'bg-blue-100 text-blue-800',
                orange: 'bg-orange-100 text-orange-800',
                red: 'bg-red-100 text-red-800'
            }[color];
            
            return `<span class="text-xs px-2 py-1 ${bgColor} rounded font-medium">${label}: ${score}/100</span>`;
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            const intervals = {
                ann√©e: 31536000,
                mois: 2592000,
                semaine: 604800,
                jour: 86400,
                heure: 3600,
                minute: 60
            };
            
            for (const [name, value] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / value);
                if (interval >= 1) {
                    return `Il y a ${interval} ${name}${interval > 1 ? 's' : ''}`;
                }
            }
            return '√Ä l\'instant';
        }

        function populateSEOWebsiteFilter() {
            const select = document.getElementById('seoWebsiteFilter');
            if (!select || !allWebsites) return;
            
            select.innerHTML = '<option value="">Tous les sites</option>';
            allWebsites.forEach(site => {
                const option = document.createElement('option');
                option.value = site._id;
                option.textContent = site.name;
                select.appendChild(option);
            });
        }

        // Modal Functions
        window.runSEOAnalysis = function() {
            document.getElementById('seoAnalysisModal').classList.remove('hidden');
            populateSEOAnalysisWebsites();
        }

        window.closeSEOAnalysisModal = function() {
            document.getElementById('seoAnalysisModal').classList.add('hidden');
        }

        window.closeSEODetailsModal = function() {
            document.getElementById('seoDetailsModal').classList.add('hidden');
        }

        window.closeApplyRecommendationModal = function() {
            document.getElementById('applyRecommendationModal').classList.add('hidden');
        }

        function populateSEOAnalysisWebsites() {
            const select = document.getElementById('seoAnalysisWebsite');
            if (!select || !allWebsites) return;
            
            select.innerHTML = '<option value="">S√©lectionner un site</option>';
            allWebsites.forEach(site => {
                const option = document.createElement('option');
                option.value = site._id;
                option.textContent = site.name;
                select.appendChild(option);
            });
        }

        window.submitSEOAnalysis = async function() {
            const websiteId = document.getElementById('seoAnalysisWebsite').value;
            const url = document.getElementById('seoAnalysisUrl').value;
            
            if (!websiteId || !url) {
                showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }
            
            showNotification('Analyse SEO lanc√©e. Le pixel collectera les donn√©es automatiquement.', 'success');
            closeSEOAnalysisModal();
            
            setTimeout(() => {
                loadSEOAnalyses();
            }, 5000);
        }

        window.viewSEODetails = async function(analysisId) {
            try {
                showLoading('Chargement des d√©tails...');
                
                const response = await fetch(`${API_URL}/api/seo/analyses/${analysisId}`, {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                hideLoading();
                
                if (!response.ok) throw new Error('Failed to load analysis');
                
                const data = await response.json();
                const analysis = data.analysis;
                
                renderSEODetailsModal(analysis);
                document.getElementById('seoDetailsModal').classList.remove('hidden');
                
            } catch (error) {
                hideLoading();
                console.error('View SEO details error:', error);
                showNotification('Erreur lors du chargement des d√©tails', 'error');
            }
        }

        function renderSEODetailsModal(analysis) {
            const content = document.getElementById('seoDetailsContent');
            content.innerHTML = `
                <div class="space-y-6">
                    <div>
                        <h4 class="font-bold text-lg mb-4">üìä Scores D√©taill√©s</h4>
                        <div class="grid grid-cols-5 gap-4">
                            ${renderDetailScore('Meta', analysis.score.meta, 'blue')}
                            ${renderDetailScore('Contenu', analysis.score.content, 'green')}
                            ${renderDetailScore('Structure', analysis.score.structure, 'purple')}
                            ${renderDetailScore('Performance', analysis.score.performance, 'orange')}
                            ${renderDetailScore('Mobile', analysis.score.mobile, 'pink')}
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-bold text-lg mb-4">‚ö†Ô∏è Probl√®mes D√©tect√©s (${analysis.issues.length})</h4>
                        <div class="space-y-2 max-h-64 overflow-y-auto">
                            ${analysis.issues.map(issue => `
                                <div class="border-l-4 ${issue.severity === 'critical' ? 'border-red-500 bg-red-50' : issue.severity === 'warning' ? 'border-orange-500 bg-orange-50' : 'border-blue-500 bg-blue-50'} pl-4 py-3 rounded">
                                    <div class="font-semibold text-gray-900">${issue.message}</div>
                                    <div class="text-sm text-gray-600 mt-1"><strong>Fix:</strong> ${issue.fix}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-bold text-lg mb-4">ü§ñ Recommandations IA (${analysis.recommendations.length})</h4>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            ${analysis.recommendations.map((rec, idx) => `
                                <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-bold text-gray-900">${rec.title}</div>
                                        <span class="text-xs px-2 py-1 rounded font-medium ${rec.priority === 'high' ? 'bg-red-100 text-red-800' : rec.priority === 'medium' ? 'bg-orange-100 text-orange-800' : 'bg-blue-100 text-blue-800'}">
                                            ${rec.priority.toUpperCase()}
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-600 mb-3">${rec.description}</p>
                                    <button onclick="applyRecommendation('${analysis._id}', ${idx})" 
                                            class="text-sm px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors">
                                        ‚ú® Appliquer cette r√®gle
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDetailScore(label, score, color) {
            return `
                <div class="text-center p-4 bg-${color}-50 rounded-lg">
                    <div class="text-3xl font-bold text-${color}-600 mb-1">${score}</div>
                    <div class="text-xs text-gray-600">${label}</div>
                </div>
            `;
        }

        window.applyRecommendation = function(analysisId, recommendationIndex) {
            currentAnalysisId = analysisId;
            currentRecommendationIndex = recommendationIndex;
            
            document.getElementById('applyRecommendationModal').classList.remove('hidden');
        }

        window.submitApplyRecommendation = async function() {
            if (!currentAnalysisId || currentRecommendationIndex === null) return;
            
            const modifications = {
                title: document.getElementById('applyTitle').value,
                metaDescription: document.getElementById('applyDescription').value,
                h1: document.getElementById('applyH1').value
            };
            
            try {
                showLoading('Cr√©ation de la r√®gle SEO...');
                
                const response = await fetch(`${API_URL}/api/seo/apply-optimization`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        analysisId: currentAnalysisId,
                        recommendationIndex: currentRecommendationIndex,
                        modifications
                    })
                });
                
                hideLoading();
                
                if (!response.ok) throw new Error('Failed to apply optimization');
                
                showNotification('R√®gle SEO cr√©√©e avec succ√®s !', 'success');
                closeApplyRecommendationModal();
                closeSEODetailsModal();
                
            } catch (error) {
                hideLoading();
                console.error('Apply recommendation error:', error);
                showNotification('Erreur lors de la cr√©ation de la r√®gle', 'error');
            }
        }

        console.log('üöÄ SEO Platform initialized - Ready to go!');
    </script>
</body>
</html>
